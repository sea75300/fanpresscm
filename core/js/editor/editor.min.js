if(fpcm===void 0)var fpcm={};fpcm.editor={init:function(){fpcm.editor.initToolbar(),fpcm.vars.jsvars.isRevision?fpcm.dom.fromClass("fpcm-ui-editor-categories-revisiondiff .fpcm-ui-input-checkbox").click(function(){return!1}):fpcm.editor[fpcm.vars.jsvars.editorInitFunction].call(),document.addEventListener("keydown",function(e){if(e.ctrlKey&&e.which==83){e.preventDefault();var t=fpcm.dom.fromId("btnArticleSave");if(t)return t.click(),!1}})},initAfter:function(){fpcm.ui.autocomplete("#articleimagepath",{source:fpcm.vars.ajaxActionPath+"autocomplete&src=editorfiles",minLength:3})},initTinyMce:function(){fpcm.vars.jsvars.editorConfig.file_picker=function(e){return fpcm.editor.filePickerCallback=e,fpcm.editor.filePickerActions={fmUpload:"btnFileUpload",fmSearch:"btnOpenSearch",fmNewThumbs:"btnCreateThumbs",fmDelete:"btnDeleteFiles",fmGallery:"btnInsertGallery"},_btns=[{type:"custom",name:"fmSearch",text:fpcm.ui.translate("ARTICLES_SEARCH"),disabled:!1,primary:!1,align:"start"}],fpcm.vars.jsvars.filemanagerPermissions.add&&_btns.push({type:"custom",name:"fmUpload",text:fpcm.ui.translate("FILE_LIST_UPLOADFORM"),disabled:!1,primary:!0,align:"start"}),fpcm.editor.insertGalleryDisabled()||_btns.push({type:"custom",name:"fmGallery",text:fpcm.ui.translate("FILE_LIST_INSERTGALLERY"),disabled:!1,primary:!1}),fpcm.vars.jsvars.filemanagerPermissions.thumbs&&_btns.push({type:"custom",name:"fmNewThumbs",text:fpcm.ui.translate("FILE_LIST_NEWTHUMBS"),disabled:!1,primary:!1}),fpcm.vars.jsvars.filemanagerPermissions.delete&&_btns.push({type:"custom",name:"fmDelete",text:fpcm.ui.translate("GLOBAL_DELETE"),disabled:!1,primary:!1}),_btns.push({type:"cancel",name:"fmClose",text:fpcm.ui.translate("GLOBAL_CLOSE"),disabled:!1,primary:!0}),tinymce.activeEditor.windowManager.openUrl({title:fpcm.ui.translate("HL_FILES_MNG"),size:"large",url:fpcm.vars.jsvars.filemanagerUrl+fpcm.vars.jsvars.filemanagerMode,id:"fpcm-dialog-editor-tinymce-filemanager",buttons:_btns,onAction:function(e,t){if(!fpcm.editor.filePickerActions[t.name])return!1;e.sendMessage({mceAction:"clickFmgrBtn",cmd:fpcm.editor.filePickerActions[t.name],validSource:window.location.href})}}),!0},fpcm.vars.jsvars.editorConfig.onPaste=function(e,t){var n=fpcm.editor_videolinks.replace(t.content);if(n===t.content)return!0;fpcm.ui_loader.show(),t.content=fpcm.editor_videolinks.createFrame(n,!0),fpcm.ui_loader.hide()},fpcm.vars.jsvars.editorConfig.onInitAfterStd=function(e){e.ui.registry.addButton("fpcm_emoticons",{icon:"emoji",tooltip:fpcm.ui.translate("EDITOR_INSERTSMILEY"),disabled:!1,onAction:function(){tinymce.activeEditor.windowManager.open({title:fpcm.ui.translate("EDITOR_INSERTSMILEY"),size:"normal",body:{type:"panel",items:[{type:"collection",name:"smileyList"}]},buttons:[{type:"cancel",text:fpcm.ui.translate("GLOBAL_CLOSE"),disabled:!1,primary:!0}],initialData:{smileyList:fpcm.vars.jsvars.editorConfig.fpcmEmoticons},onAction:function(t,n){n.value&&e.insertContent(n.value),t.close()}})},onSetup:function(){fpcm.ajax.get("editor/smileys",{quiet:!0,dataType:"json",data:{json:!0},execDone:function(e){fpcm.vars.jsvars.editorConfig.fpcmEmoticons=[];for(var t=0;t<e.length;t++)fpcm.vars.jsvars.editorConfig.fpcmEmoticons.push({text:e[t].code,value:" "+e[t].code+" ",icon:e[t].img})}})}});var t="fpcm-content-gallery-placeholder";e.on("ResolveName",function(n){n.target.nodeName==="FIGURE"&&e.dom.hasClass(n.target,t)&&(n.name="gallery")}),e.on("BeforeSetContent",function(e){let i=e.content.match(/\[gallery\](.*)\[\/gallery\]/i),a=e.content.search(t)>0;if(!i||a)return!0;let n=i[1].split("|");if(!n.length)return!0;let s=[];for(var o=0;o<n.length;o++){if(!n[o])continue;let e=n[o].split(/(thumb:)?([a-z0-9_.\-/]*)(:link)?/i);if(!e||!e.length)continue;let t=fpcm.vars.jsvars.uploadFileRoot+(e[1]===fpcm.vars.jsvars.galleryThumbStr?e[2].replace("/","/thumbs/"):e[2]);s.push('<img src="'+t+'" class="fpcm-content-gallery-item" data-mce-resize="false" data-mce-placeholder="1"  data-item="'+n[o]+'" />')}return!s.length||(s.unshift('<figure role="group" class="'+t+'" data-mce-placeholder="1" data-placeholder="'+i[0]+'">'),s.push("</figure>"),e.content=e.content.replace(i[0],s.join("")),!0)}),e.on("PreInit",function(){e.serializer.addNodeFilter("figure",function(e){if(!e.length)return!0;for(var n=0;n<e.length;n++){if(!e[n])continue;let s=e[n];if(s.attr("class")!==t)continue;s.value=s.attr("data-placeholder"),s.raw=!0,s.type=3}})}),e.on("NodeChange",function(e){if(!e.selectionChange||e.element.nodeName!="FIGURE"||!e.element.classList.contains(t))return!0;if(!e.element.children.length)return!0;let n=[];for(var s=0;s<e.element.children.length;s++)n.push(e.element.children[s].dataset.item);return!n.length||(e.element.dataset.placeholder="[gallery]"+n.join("|")+"[/gallery]",!0)})},fpcm.editor_tinymce.create(fpcm.vars.jsvars.editorConfig)},initCodeMirrorAutosave:function(){fpcm.vars.jsvars.autoSaveStorage=localStorage.getItem(fpcm.vars.jsvars.editorConfig.autosavePref),setInterval(function(){var e=fpcm.editor.cmInstance.getValue();if(!e)return!1;if(e===localStorage.getItem(fpcm.vars.jsvars.editorConfig.autosavePref))return!0;localStorage.setItem(fpcm.vars.jsvars.editorConfig.autosavePref,e),fpcm.dom.fromId("editor-html-buttonrestore").prop("disabled",!1)},3e4)},initCodeMirror:function(){fpcm.editor.cmInstance=fpcm.editor_codemirror.create({editorId:"htmleditor",elementId:"articlecontent",extraKeys:fpcm.editor_codemirror.defaultShortKeys}),fpcm.editor.cmInstance.setSize("100%","50vh"),fpcm.editor.cmInstance.on("paste",function(e,t){if(t.clipboardData===void 0)return!0;var n=t.clipboardData.getData("Text"),s=fpcm.editor_videolinks.replace(n);return n!==s&&(fpcm.ui_loader.show(),t.preventDefault(),fpcm.editor_videolinks.createFrame(s,!1),fpcm.ui_loader.hide(),!0)}),fpcm.editor.initCodeMirrorAutosave()},showInEditDialog:function(e){if(fpcm.vars.jsvars.checkLastState==1&&e.articleCode==0&&fpcm.ui.addMessage({type:"notice",id:"fpcm-editor-notinedit",icon:"check",txt:fpcm.ui.translate("EDITOR_STATUS_NOTINEDIT")},!0),fpcm.vars.jsvars.checkLastState==0&&e.articleCode==1){var t=fpcm.ui.translate("EDITOR_STATUS_INEDIT");fpcm.ui.addMessage({type:"neutral",id:"fpcm-editor-inedit",icon:"pencil-square",txt:t.replace("{{username}}",e.username)},!0)}fpcm.vars.jsvars.checkLastState=e.articleCode},getGalleryReplacement:function(e){return fpcm.vars.jsvars.editorGalleryTagStart.replace("{{IMAGES}}",fpcm.vars.jsvars.editorGalleryTagThumb+e.join(fpcm.vars.jsvars.editorGalleryTagLink+"|"+fpcm.vars.jsvars.editorGalleryTagThumb)+fpcm.vars.jsvars.editorGalleryTagLink)},manageSources:function(e,t){if(!e.length){let t=fpcm.ui.getIcon("list-ul",{stack:"ban fpcm-ui-important-text",stackTop:!0})+" "+fpcm.ui.translate("GLOBAL_NOTFOUND2");e=[{value:!1,label:t}]}let s=fpcm.ui.translate("GLOBAL_DELETE"),n='<div class="list-group">';for(var o in e){let t=e[o],i="",a=t.label;t.value&&(i=` <button type="button" class="btn-close" aria-label="${s}" title="${s}" data-src-del-item="${t.value}"></button>`,a=` <a href="${t.value}" target="_blank" rel='external'>${t.label}</a>`),n+=`<div class="list-group-item d-flex justify-content-between align-items-start"><div class="align-self-center">${a}</div>${i}</div>`}if(n+="</div>",t)return t.innerHTML=n,!1;fpcm.ui_dialogs.create({id:"sources-mgr",title:fpcm.ui.translate("SYSTEM_OPTIONS_NEWS_SOURCESLIST"),content:n,closeButton:!0,dlOnOpenAfter:function(e){fpcm.dom.bindClick("button[data-src-del-item]",function(t,n){fpcm.ajax.post("autocompleteCleanup",{data:{term:n.dataset.srcDelItem,src:"articlesources"},execDone:function(){let s=n.parentElement.parentElement;if(n.parentElement.remove(),s.childNodes.length)return!0;fpcm.editor.manageSources([],e.children[0].children[0].children[2])}})})}})}}