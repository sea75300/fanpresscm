if(fpcm===void 0)var fpcm={};fpcm.filemanager={tabsObj:{},init:function(){fpcm.ui_tabs.render("#files",{reload:!0,onRenderHtmlAfter:function(e,t){t.data&&t.data.pager&&(fpcm.vars.jsvars.pager=t.data.pager),fpcm.filemanager.initListActions()}}),fpcm.ui.langvarExists("ARTICLES_SEARCH")&&fpcm.filemanager.initFilesSearch(),fpcm.filemanager.initNewThumbButton(),fpcm.filemanager.initDeleteMultipleButton()},initAfter:function(){if(fpcm.vars.jsvars.fmgrMode!==1)return;fpcm.dom.bindClick("#btnSettings",function(){let e=fpcm.ui_dialogs.fromDOM("filesSettings");if(!e)return;fpcm.ui_dialogs.create({id:"files-settings",title:"HL_OPTIONS",size:"",closeButton:!0,directAssignToDom:!0,content:e,icon:{icon:"cogs"},dlOnOpenAfter:function(){fpcm.ui.selectmenu("select[data-user_setting]",{change:function(e,t){document.getElementById("pageSelect").selectedIndex=0,fpcm.ajax.post("setconfig",{data:{var:t.dataset.user_setting,value:t.value},execDone:function(){fpcm.filemanager.reloadFiles(),fpcm.vars.jsvars.dialogs.filesSettings.fields[t.dataset.user_setting].preSelected=t.value}})}})}})})},initListActions:function(){fpcm.ui.assignCheckboxes(),fpcm.ui.initLightbox(),fpcm.filemanager.initPagination(),fpcm.filemanager.initInsertButtons(),fpcm.filemanager.initRenameButtons(),fpcm.filemanager.initEditButtons(),fpcm.filemanager.initDeleteButtons(),fpcm.filemanager.initAltTextButtons(),fpcm.filemanager.initPropertiesButton(),fpcm.filemanager.initCopyButton()},initInsertButtons:function(){if(fpcm.vars.jsvars.fmgrMode===2)return fpcm.dom.bindClick(".fpcm-filelist-tinymce-thumb",function(e,t){parent.fpcm.editor.insertThumbByEditor(t.href,t.dataset.imgtext),fpcm.ui_dialogs.close("editor-html-filemanager",!0)}),fpcm.dom.bindClick(".fpcm-filelist-tinymce-full",function(e,t){parent.fpcm.editor.insertFullByEditor(t.href,t.dataset.imgtext),fpcm.ui_dialogs.close("editor-html-filemanager",!0)}),fpcm.dom.bindClick("#btnInsertGallery",function(){var e=[];return fpcm.dom.fromClass("fpcm-ui-list-checkbox:checked").map(function(t,n){e.push(jQuery(n).data("gallery"))}),!!e.length&&(parent.fpcm.editor.insertGalleryByEditor(e),!1)}),!1;if(fpcm.vars.jsvars.fmgrMode===3)return fpcm.dom.bindClick(".fpcm-filelist-articleimage",function(e,t){parent.document.getElementById("articleimagepath").value=t.href,fpcm.ui_dialogs.close("editor-html-filemanager",!0)}),!1;fpcm.vars.jsvars.fmgrMode===4&&(fpcm.dom.bindClick(".fpcm-filelist-tinymce-thumb",function(e,t){parent.document.getElementById("mediaposter").value=t.href,fpcm.ui_dialogs.close("editor-html-filemanager",!0)}),fpcm.dom.bindClick(".fpcm-filelist-tinymce-full",function(e,t){parent.document.getElementById("mediaposter").value=t.href,fpcm.ui_dialogs.close("editor-html-filemanager",!0)}))},initRenameButtons:function(){fpcm.dom.bindClick(".fpcm-filelist-rename",function(e){if(!fpcm.ui.langvarExists("FILE_LIST_RENAME_NEWNAME"))return console.log("FILE_LIST_RENAME_NEWNAME"),!1;var s=e.delegateTarget.dataset.file,n=new fpcm.ui.forms.input;return n.name="new-filename-dialog",n.label=fpcm.ui.translate("FILE_LIST_FILENAME"),n.value=e.delegateTarget.dataset.oldname,n.placeholder=e.delegateTarget.dataset.oldname,fpcm.ui_dialogs.create({id:"files-rename",title:"FILE_LIST_RENAME_NEWNAME",closeButton:!0,content:n,dlButtons:[{text:"GLOBAL_SAVE",icon:"save",clickClose:!0,primary:!0,click:function(){let e=document.getElementById("fpcm-id-new-filename-dialog");if(!e.value||!e.value.match(/^[a-z0-9_.\-()]+$/i)){fpcm.ui.addMessage({txt:e.validationMessage,type:"error"});return}fpcm.ajax.post("files/rename",{data:{newName:e.value,oldName:s},execDone:function(e){fpcm.ui.addMessage(e),fpcm.filemanager.reloadFiles()}})}}],dlOnOpenAfter:function(){document.getElementById("fpcm-id-new-filename-dialog").focus()}}),!1})},initEditButtons:function(){fpcm.dom.bindClick(".fpcm-filelist-link-edit",function(e,t){return fpcm.imageEditor.initEditorDialog({afterUpload:function(){fpcm.filemanager.reloadFiles(),fpcm.ui_dialogs.close("files-editor")},data:t.dataset}),!1})},initAltTextButtons:function(){fpcm.dom.bindClick(".fpcm-filelist-link-alttext",function(e,t){var n=new fpcm.ui.forms.input;return n.name="alt-text-dialog",n.label=fpcm.ui.translate("FILE_LIST_ALTTEXT"),n.value=t.dataset.alttext,n.placeholder=t.dataset.alttext,fpcm.ui_dialogs.create({id:"files-alttext",title:"FILE_LIST_ALTTEXT",closeButton:!0,content:n,dlButtons:[{text:fpcm.ui.translate("GLOBAL_SAVE"),icon:"save",clickClose:!0,primary:!0,click:function(){fpcm.ajax.post("files/alttext",{data:{file:t.dataset.file,alttext:fpcm.dom.fromId("fpcm-id-alt-text-dialog").val()},execDone:function(e){fpcm.ui.addMessage(e),fpcm.filemanager.reloadFiles()}})}}],dlOnOpenAfter:function(){document.getElementById("fpcm-id-alt-text-dialog").focus()}}),!1})},initDeleteButtons:function(){fpcm.dom.bindClick(".fpcm-filelist-delete",function(e,t){return fpcm.ui_dialogs.confirm({clickNoDefault:!0,focusNo:!0,clickYes:function(){return fpcm.ajax.post("files/delete",{dataType:"json",data:{filename:t.dataset.file},execDone:function(e){return e.txt.replace("{{filenames}}",t.dataset.filename),fpcm.ui.addMessage(e),fpcm.filemanager.reloadFiles(),!1}}),!1}}),!1})},initNewThumbButton:function(){fpcm.dom.bindClick("#btnCreateThumbs",function(e,t){var n=fpcm.dom.getCheckboxCheckedValues(".fpcm-ui-list-checkbox");return!!n&&!!n.length&&(t.disabled=!0,fpcm.ajax.post("files/createthumbs",{async:!0,loaderMsg:fpcm.ui.translate("MSG_FILES_CREATETHUMBS"),data:{items:n},execDone:function(e){for(var n in e){let t=e[n];fpcm.ui.addMessage(t,n==1)}fpcm.filemanager.reloadFiles(),t.disabled=!1}}),!1)})},initDeleteMultipleButton:function(){fpcm.dom.bindClick("#btnDeleteFiles",function(){var e=fpcm.dom.getCheckboxCheckedValues(".fpcm-ui-list-checkbox");return!!e&&!!e.length&&(fpcm.ui_dialogs.confirm({focusNo:!0,clickYes:function(){return fpcm.ajax.post("files/delete",{dataType:"json",data:{filename:e,multiple:1},execDone:function(e){jQuery.each(e,function(e,t){fpcm.ui.addMessage(t,e==1)}),fpcm.dom.fromId("fpcm-select-all").prop("checked",!1),fpcm.filemanager.reloadFiles()}}),!1}}),!1)})},initCopyButton:function(){fpcm.dom.bindClick('a.dropdown-item[data-fn="system.createCopy"]',function(e){fpcm.system.createCopy(e)})},initPropertiesButton:function(){let e=[{prop:"filetime",label:"GLOBAL_LASTCHANGE",icon:new fpcm.ui.forms.icon("calendar","lg"),class:"mb-2"},{prop:"fileuser",label:"FILE_LIST_UPLOAD_BY",icon:new fpcm.ui.forms.icon("user","lg"),class:"mb-2"},{prop:"filesize",label:"FILE_LIST_FILESIZE",icon:new fpcm.ui.forms.icon("weight","lg"),class:"mb-2"},{prop:"resulution",label:"FILE_LIST_RESOLUTION",icon:new fpcm.ui.forms.icon("maximize","lg"),class:"mb-2"},{prop:"filemime",label:"FILE_LIST_FILETYPE",icon:new fpcm.ui.forms.icon("file-circle-question","lg"),class:"mb-2"},{prop:"filehash",label:"FILE_LIST_FILEHASH",icon:new fpcm.ui.forms.icon("hashtag","lg"),class:"mb-2"},{prop:"credits",label:"FILE_LIST_FILECREDITS",icon:new fpcm.ui.forms.icon("copyright","lg"),class:"mb-2"}];fpcm.dom.bindClick(".fpcm-filelist-properties",function(t,n){let s="",o="",i=document.createElement("div");for(var a in e){let t=e[a];switch(t.prop){case"resulution":s=n.dataset.fileresx+" X "+n.dataset.fileresy+" "+fpcm.ui.translate("FILE_LIST_RESOLUTION_PIXEL"),o=n.dataset.fileresx+fpcm.ui.getIcon("times")+n.dataset.fileresy+" "+fpcm.ui.translate("FILE_LIST_RESOLUTION_PIXEL");break;default:s=n.dataset[t.prop],o=n.dataset[t.prop];break}let r=document.createElement("div");r.className="row g-0 "+t.class;let d=t.icon;d.iconClass="me-2";let l=document.createElement("div");l.className="col-form-label align-self-center col-12 col-md-3 me-3",l.innerHTML=d.getString()+fpcm.ui.translate(t.label),r.appendChild(l);let c=document.createElement("div");c.className="col align-self-center",c.innerHTML=o,c.title=s,r.appendChild(c),i.appendChild(r)}fpcm.ui_dialogs.create({id:"files-properties",title:fpcm.ui.translate("GLOBAL_PROPERTIES"),closeButton:!0,directAssignToDom:!0,content:i})})},initPagination:function(){fpcm.ui.initPager({backAction:function(){fpcm.filemanager.reloadFiles(fpcm.vars.jsvars.pager.showBackButton)},nextAction:function(){fpcm.filemanager.reloadFiles(fpcm.vars.jsvars.pager.showNextButton)},selectAction:function(e,t){fpcm.filemanager.reloadFiles(t.value)}})},reloadFiles:function(e,t){return e||(e=fpcm.filemanager.getCurrentPage()),fpcm.dom.assignHtml("#fpcm-tab-files-list-pane",fpcm.vars.jsvars.loaderTpl.replace(/\{\$thumbsize\}/g,fpcm.vars.jsvars.thumbsize)),t&&(fpcm.vars.jsvars.filesLastSearch=(new Date).getTime()),fpcm.ajax.getItemList({module:"files",destination:"#fpcm-tab-files-list-pane",mode:fpcm.vars.jsvars.fmgrMode,page:e,filter:t||null,loader:!1,dataType:"json",onAssignHtmlAfter:function(e){e.data&&e.data.pager&&(fpcm.vars.jsvars.pager=e.data.pager),fpcm.filemanager.initListActions(),fpcm.dom.fromClass("fpcm-select-all").prop("checked",!1)}}),!1},initFilesSearch:function(){fpcm.dom.bindClick("#btnOpenSearch",function(){let t=fpcm.vars.jsvars.searchForm,n=document.createElement("div");for(var e in t.fields){let o=t.fields[e],s=new fpcm.ui.forms[o.call];if(s.name=e,o.class+=" "+s.class,s.wrapper="form-floating",!s.assignFormObject)continue;s.assignFormObject(o);let i=document.createElement("div");i.className="row mb-3";let a=document.createElement("div");a.className="col-12"+(o.noCombination?"":" col-md-9"),s.assignToDom(a),i.appendChild(a);let r=document.createElement("div");if(r.className="col-12 col-md-3 align-self-center",!o.noCombination){let n=new fpcm.ui.forms.select;n.name="combination"+e.charAt(0).toUpperCase()+e.slice(1),n.options=t.combinations.default,n.class="fpcm-ui-input-select-filessearch-combination "+n.class,n.wrapper="form-floating",n.label="ARTICLE_SEARCH_LOGIC",n.assignToDom(r)}i.appendChild(r),n.appendChild(i)}return fpcm.ui_dialogs.create({id:"files-search",title:"ARTICLES_SEARCH",closeButton:!0,directAssignToDom:!0,content:n,dlButtons:[{text:fpcm.ui.translate("ARTICLE_SEARCH_START"),icon:"check",primary:!0,clickClose:!0,click:function(){var n=fpcm.dom.getValuesByClass("fpcm-files-search-input");n.combinations=fpcm.dom.getValuesByClass("fpcm-ui-input-select-filessearch-combination"),fpcm.filemanager.startFilesSearch(n)}},{text:fpcm.ui.translate("GLOBAL_RESET"),icon:"filter-circle-xmark",clickClose:!0,click:function(){fpcm.ui.relocate("self")}}],dlOnOpenAfter:function(){document.getElementById("fpcm-id-filename").focus()}}),!1})},startFilesSearch:function(e){if((new Date).getTime()-fpcm.vars.jsvars.filesLastSearch<1e4)return fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate("SEARCH_WAITMSG")}),!1;fpcm.filemanager.reloadFiles(1,e)},runFileIndexUpdate:function(){fpcm.ajax.get("crons/exec",{data:{cjId:"fileindex"},loaderMsg:fpcm.ui.translate("FILE_LIST_ADDTOINDEX"),execDone:function(){fpcm.ui_tabs.show("#files",0)}})},getCurrentPage:function(){let e=document.getElementById("pageSelect");return!e||e.options.length<2||e.value===void 0?1:e.value}}