if(fpcm===void 0)var fpcm={};fpcm.articles={categoryMs:null,init:function(){fpcm.worker.postMessage({namespace:"articles",function:"loadArticles",id:"articles.loadArticles",param:{page:fpcm.vars.jsvars.listPage}}),fpcm.articles.initArticleSearch(),fpcm.dom.bindClick("#massEdit",function(){fpcm.system.initMassEditDialog("articles/massedit","articles-massedit",fpcm.articles,{onSuccess:function(){fpcm.articles.loadArticles({loader:!0}),fpcm.dom.resetValuesByIdsSelect(["meUserid","mePinned","meDraft","meApproval","meComments","meArchived"])}})})},initWidgets:function(){fpcm.articles.categoryMs||(fpcm.articles.categoryMs=fpcm.ui.multiselect("categories"))},onMassEditorDialogClose:function(){return!!fpcm.articles.categoryMs&&(fpcm.articles.categoryMs.clear(),fpcm.articles.categoryMs=null,!0)},initArticleSearch:function(){fpcm.dom.bindClick("#opensearch",function(){fpcm.ui_dialogs.create({id:"articles-search",title:"ARTICLES_SEARCH",closeButton:!0,dlButtons:[{text:"ARTICLE_SEARCH_START",icon:"search",primary:!0,clickClose:!0,click:function(){let e={};if(e=fpcm.dom.getValuesByClass("fpcm-articles-search-input"),e.combinations=fpcm.dom.getValuesByClass("fpcm-ui-input-select-articlesearch-combination"),(new Date).getTime()-fpcm.vars.jsvars.articlesLastSearch<1e4)return fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate("SEARCH_WAITMSG")}),!1;fpcm.articles.loadArticles({filter:e}),fpcm.vars.jsvars.articlesLastSearch=(new Date).getTime()}},{text:fpcm.ui.translate("GLOBAL_RESET"),icon:"filter-circle-xmark",clickClose:!0,click:function(){fpcm.ui.relocate("self")}}],dlOnOpen:function(){fpcm.dom.setFocus("text")}})})},loadArticles:function(e){e||(e={});let t={mode:fpcm.vars.jsvars.listMode,page:e.page!==void 0?parseInt(e.page):1,module:"articles",onRenderDataViewAfter:function(){fpcm.articles.clearArticleCache(),fpcm.articles.tweetSingleActions(),fpcm.articles.deleteSingleArticle()},onPagerNext:function(){return fpcm.articles.loadArticles({page:fpcm.vars.jsvars.pager.showNextButton,loader:!0}),!0},onPagerBack:function(){return fpcm.articles.loadArticles({page:fpcm.vars.jsvars.pager.showBackButton,loader:!0}),!0},onPagerSelect:function(e,t){return fpcm.articles.loadArticles({page:t.value,loader:!0}),!0}};e.filter instanceof Object&&(t.filter=e.filter),fpcm.ajax.getItemList(t)},articleActionsTweet:function(){let e=fpcm.dom.getCheckboxCheckedValues(".fpcm-ui-list-checkbox");if(e.length==0)return!1;fpcm.articles._showTweetDialog(e)},_showTweetDialog:function(e){if(!e||e.length==0)return!1;fpcm.ui_dialogs.create({title:"EDITOR_TWEET_TEXT",closeButton:!0,content:`<div class="row mb-5"><div class="col flex-grow-1">${fpcm.vars.jsvars.newTweetFields[0]}</div><div class="col-auto mb-3 align-self-center">${fpcm.vars.jsvars.newTweetFields[1]}</div></div>`,dlOnClose:function(){fpcm.dom.resetCheckboxesByClass("fpcm-ui-list-checkbox"),fpcm.dom.resetValuesByIdsString(["twitterText"],"")},dlOnOpenAfter:function(){let e=fpcm.dom.fromId("twitterText");fpcm.dom.bindClick("#twitterReplacements li > a.dropdown-item",function(t,n){if(!n.dataset.var)return!1;let s=e.val(),o=fpcm.dom.fromTag(e).prop("selectionStart");e.val(s.substring(0,o)+n.dataset.var+s.substring(o))})},dlButtons:[{text:"ARTICLE_LIST_NEWTWEET",icon:"brands fa-twitter",primary:!0,clickClose:!0,click:function(t,n){n.childNodes[0].className="",n.childNodes[0].innerHTML='<div class="spinner-border spinner-border-sm text-light" role="status"></div';let s=fpcm.dom.fromId("twitterText").val();fpcm.articles.execNewTweet(e,s)}}]})},execNewTweet:function(e,t){fpcm.ajax.post("articles/tweet",{data:{ids:fpcm.ajax.toJSON(e),text:t},async:!1,dataType:"json",execDone:function(e){fpcm.articles.resetActionsMenu(),e.notice!=0&&fpcm.ui.addMessage({type:"notice",txt:fpcm.ui.translate(e.notice)}),e.error!=0&&fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate(e.error)})}})},clearArticleCache:function(){fpcm.dom.bindClick(".fpcm-article-cache-clear",function(e,t){fpcm.system.clearCache({cache:t.dataset.cache?t.dataset.cache:"",objid:t.dataset.objid?t.dataset.objid:0})})},tweetSingleActions:function(){fpcm.dom.bindClick(".fpcm-ui-article-twitter-single",function(e,t){fpcm.articles._showTweetDialog([t.dataset.articleid])})},deleteSingleArticle:function(){fpcm.dom.bindClick(".fpcm-ui-button-delete-article-single",function(e,t){fpcm.ui_dialogs.confirm({clickYes:function(){fpcm.ajax.exec("articles/delete",{dataType:"json",pageToken:"articles/delete",data:{id:t.dataset.articleid},execDone:function(e){if(e.code==1)return fpcm.articles.loadArticles({loader:!0}),!0;fpcm.ui.addMessage({txt:"DELETE_FAILED_ARTICLE",type:"error"},!0)}})}})})},deleteMultipleArticle:function(){var e=fpcm.dom.getCheckboxCheckedValues(".fpcm-ui-list-checkbox");return e.length==0?(fpcm.ui_loader.hide(),!1):(fpcm.ui_dialogs.confirm({clickYes:function(){fpcm.ajax.exec("articles/delete",{dataType:"json",pageToken:"articles/delete",data:{id:e,multiple:1},execDone:function(e){if(fpcm.articles.resetActionsMenu(),e.code==1)return fpcm.articles.loadArticles({loader:!0}),!0;fpcm.ui.addMessage({txt:"DELETE_FAILED_ARTICLE",type:"error"},!0),fpcm.dom.resetCheckboxesByClass("fpcm-ui-list-checkbox")}})}}),!0)},clearMultipleArticleCache:function(){fpcm.system.clearCache({cache:fpcm.vars.jsvars.artCacheMod,objid:0}),fpcm.dom.resetCheckboxesByClass("fpcm-ui-list-checkbox")},resetActionsMenu:function(){return fpcm.dom.resetValuesByIdsSelect("action"),!0}}