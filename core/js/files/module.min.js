if(fpcm===void 0)var fpcm={};fpcm.filemanager={tabsObj:{},init:function(){fpcm.ui_tabs.render("#files",{reload:!0,onRenderHtmlAfter:function(e,t){t.data&&t.data.pager&&(fpcm.vars.jsvars.pager=t.data.pager),fpcm.filemanager.initListActions()}}),fpcm.ui.langvarExists("ARTICLES_SEARCH")&&fpcm.filemanager.initFilesSearch(),fpcm.filemanager.initNewThumbButton(),fpcm.filemanager.initDeleteMultipleButton()},initAfter:function(){fpcm.vars.jsvars.fmgrMode===1&&fpcm.ui.selectmenu("select[data-user_setting]",{change:function(e,t){document.getElementById("pageSelect").selectedIndex=0,fpcm.ajax.post("setconfig",{data:{var:t.dataset.user_setting,value:t.value},execDone:fpcm.filemanager.reloadFiles})}}),fpcm.dom.fromId("btnFmgrUploadBack").click(function(){fpcm.ui_tabs.show("#files",0)})},initListActions:function(){fpcm.ui.assignCheckboxes(),fpcm.ui.initLightbox(),fpcm.filemanager.initPagination(),fpcm.filemanager.initInsertButtons(),fpcm.filemanager.initRenameButtons(),fpcm.filemanager.initEditButtons(),fpcm.filemanager.initDeleteButtons(),fpcm.filemanager.initAltTextButtons(),fpcm.filemanager.initPropertiesButton()},initInsertButtons:function(){if(fpcm.vars.jsvars.fmgrMode===2)return fpcm.dom.bindClick(".fpcm-filelist-tinymce-thumb",function(e,t){parent.fpcm.editor.insertThumbByEditor(t.href,t.dataset.imgtext),fpcm.ui_dialogs.close("editor-html-filemanager",!0)}),fpcm.dom.bindClick(".fpcm-filelist-tinymce-full",function(e,t){parent.fpcm.editor.insertFullByEditor(t.href,t.dataset.imgtext),fpcm.ui_dialogs.close("editor-html-filemanager",!0)}),fpcm.dom.bindClick("#btnInsertGallery",function(){var e=[];return fpcm.dom.fromClass("fpcm-ui-list-checkbox:checked").map(function(t,n){e.push(jQuery(n).data("gallery"))}),!!e.length&&(parent.fpcm.editor.insertGalleryByEditor(e),!1)}),!1;if(fpcm.vars.jsvars.fmgrMode===3)return fpcm.dom.bindClick(".fpcm-filelist-articleimage",function(e,t){parent.document.getElementById("articleimagepath").value=t.href,fpcm.ui_dialogs.close("editor-html-filemanager",!0)}),!1;fpcm.vars.jsvars.fmgrMode===4&&(fpcm.dom.bindClick(".fpcm-filelist-tinymce-thumb",function(e,t){parent.document.getElementById("mediaposter").value=t.href,fpcm.ui_dialogs.close("editor-html-filemanager",!0)}),fpcm.dom.bindClick(".fpcm-filelist-tinymce-full",function(e,t){parent.document.getElementById("mediaposter").value=t.href,fpcm.ui_dialogs.close("editor-html-filemanager",!0)}))},initRenameButtons:function(){fpcm.dom.fromClass("fpcm-filelist-rename").unbind("click"),fpcm.dom.fromClass("fpcm-filelist-rename").click(function(){if(!fpcm.ui.langvarExists("FILE_LIST_RENAME_NEWNAME"))return console.log("FILE_LIST_RENAME_NEWNAME"),!1;var t=this.dataset.file,e=new fpcm.ui.forms.input;return e.name="new-filename-dialog",e.label=fpcm.ui.translate("FILE_LIST_FILENAME"),e.value=this.dataset.oldname,e.placeholder=this.dataset.oldname,fpcm.ui_dialogs.create({id:"files-rename",title:"FILE_LIST_RENAME_NEWNAME",closeButton:!0,content:e,dlButtons:[{text:"GLOBAL_SAVE",icon:"save",clickClose:!0,primary:!0,click:function(){fpcm.ajax.post("files/rename",{data:{newName:fpcm.dom.fromId("fpcm-id-new-filename-dialog").val(),oldName:t},execDone:function(e){fpcm.ui.addMessage(e),fpcm.filemanager.reloadFiles()}})}}]}),!1})},initEditButtons:function(){fpcm.dom.bindClick(".fpcm-filelist-link-edit",function(e,t){return fpcm.imageEditor.initEditorDialog({afterUpload:fpcm.filemanager.reloadFiles,data:t.dataset}),!1})},initAltTextButtons:function(){fpcm.dom.bindClick(".fpcm-filelist-link-alttext",function(e,t){var n=new fpcm.ui.forms.input;return n.name="alt-text-dialog",n.label=fpcm.ui.translate("FILE_LIST_ALTTEXT"),n.value=t.dataset.alttext,n.placeholder=t.dataset.alttext,fpcm.ui_dialogs.create({id:"files-alttext",title:"FILE_LIST_ALTTEXT",closeButton:!0,content:n,dlButtons:[{text:fpcm.ui.translate("GLOBAL_SAVE"),icon:"save",clickClose:!0,clickClose:!0,click:function(){fpcm.ajax.post("files/alttext",{data:{file:t.dataset.file,alttext:fpcm.dom.fromId("fpcm-id-alt-text-dialog").val()},execDone:function(e){fpcm.ui.addMessage(e),fpcm.filemanager.reloadFiles()}})}}]}),!1})},initDeleteButtons:function(){fpcm.dom.bindClick(".fpcm-filelist-delete",function(e,t){return fpcm.ui_dialogs.confirm({clickNoDefault:!0,focusNo:!0,clickYes:function(){return fpcm.ajax.post("files/delete",{dataType:"json",data:{filename:t.dataset.file},execDone:function(e){return e.txt.replace("{{filenames}}",t.dataset.filename),fpcm.ui.addMessage(e),fpcm.filemanager.reloadFiles(),!1}}),!1}}),!1})},initNewThumbButton:function(){fpcm.dom.bindClick("#btnCreateThumbs",function(e,t){var n=fpcm.dom.getCheckboxCheckedValues(".fpcm-ui-list-checkbox");return!!n&&!!n.length&&(t.disabled=!0,fpcm.ajax.post("files/createthumbs",{async:!0,loaderMsg:fpcm.ui.translate("MSG_FILES_CREATETHUMBS"),data:{items:n},execDone:function(e){jQuery.each(e,function(e,t){fpcm.ui.addMessage(t,e==1)}),fpcm.filemanager.reloadFiles(),t.disabled=!1}}),!1)})},initDeleteMultipleButton:function(){fpcm.dom.bindClick("#btnDeleteFiles",function(){var e=fpcm.dom.getCheckboxCheckedValues(".fpcm-ui-list-checkbox");return!!e&&!!e.length&&(fpcm.ui_dialogs.confirm({focusNo:!0,clickYes:function(){return fpcm.ajax.post("files/delete",{dataType:"json",data:{filename:e,multiple:1},execDone:function(e){jQuery.each(e,function(e,t){fpcm.ui.addMessage(t,e==1)}),fpcm.dom.fromId("fpcm-select-all").prop("checked",!1),fpcm.filemanager.reloadFiles()}}),!1}}),!1)})},initPropertiesButton:function(){fpcm.filemanager.propertiesDialog={filetime:"",fileuser:"",filesize:"",resulution:"",filehash:"",filemime:"",credits:""},fpcm.dom.bindClick(".fpcm-filelist-properties",function(e,t){return fpcm.ui_dialogs.create({id:"files-properties",title:fpcm.ui.translate("GLOBAL_PROPERTIES"),closeButton:!0,dlOnOpen:function(){var n,s="",e="";for(n in fpcm.filemanager.propertiesDialog){switch(n){case"resulution":s=t.dataset.fileresx+" X "+t.dataset.fileresy+" "+fpcm.ui.translate("FILE_LIST_RESOLUTION_PIXEL"),e=t.dataset.fileresx+fpcm.ui.getIcon("times")+t.dataset.fileresy+" "+fpcm.ui.translate("FILE_LIST_RESOLUTION_PIXEL"),fpcm.dom.fromId("fpcm-dialog-files-properties-"+n).attr("title",s).html(e);break;default:s=t.dataset[n],e=t.dataset[n];break}e||(e="&nbsp"),fpcm.dom.fromId("fpcm-dialog-files-properties-"+n).html(e).attr("title",t.dataset[n])}},dlOnClose:function(){for(var e in fpcm.filemanager.propertiesDialog)fpcm.dom.fromId("fpcm-dialog-files-properties-"+e).empty().attr("title",fpcm.filemanager.propertiesDialog[e])}}),!1})},initPagination:function(){fpcm.ui.initPager({backAction:function(){fpcm.filemanager.reloadFiles(fpcm.vars.jsvars.pager.showBackButton)},nextAction:function(){fpcm.filemanager.reloadFiles(fpcm.vars.jsvars.pager.showNextButton)},selectAction:function(e,t){fpcm.filemanager.reloadFiles(t.value)}})},reloadFiles:function(e,t){return e||(e=fpcm.filemanager.getCurrentPage()),fpcm.dom.assignHtml("#fpcm-tab-files-list-pane",fpcm.vars.jsvars.loaderTpl.replace(/\{\$thumbsize\}/g,fpcm.vars.jsvars.thumbsize)),t&&(fpcm.vars.jsvars.filesLastSearch=(new Date).getTime()),fpcm.ajax.getItemList({module:"files",destination:"#fpcm-tab-files-list-pane",mode:fpcm.vars.jsvars.fmgrMode,page:e,filter:t||null,loader:!1,dataType:"json",onAssignHtmlAfter:function(e){e.data&&e.data.pager&&(fpcm.vars.jsvars.pager=e.data.pager),fpcm.filemanager.initListActions(),fpcm.dom.fromClass("fpcm-select-all").prop("checked",!1)}}),!1},initFilesSearch:function(){fpcm.dom.bindClick("#btnOpenSearch",function(){return fpcm.ui_dialogs.create({id:"files-search",title:"ARTICLES_SEARCH",closeButton:!0,dlButtons:[{text:fpcm.ui.translate("ARTICLE_SEARCH_START"),icon:"check",primary:!0,clickClose:!0,click:function(){var n=fpcm.dom.getValuesByClass("fpcm-files-search-input");n.combinations=fpcm.dom.getValuesByClass("fpcm-ui-input-select-filessearch-combination"),fpcm.filemanager.startFilesSearch(n)}},{text:fpcm.ui.translate("GLOBAL_RESET"),icon:"filter-circle-xmark",clickClose:!0,click:function(){fpcm.ui.relocate("self")}}],dlOnOpen:function(){fpcm.dom.fromId("text").focus()}}),!1})},startFilesSearch:function(e){if((new Date).getTime()-fpcm.vars.jsvars.filesLastSearch<1e4)return fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate("SEARCH_WAITMSG")}),!1;fpcm.filemanager.reloadFiles(1,e)},runFileIndexUpdate:function(){fpcm.ajax.get("crons/exec",{data:{cjId:"fileindex"},loaderMsg:fpcm.ui.translate("FILE_LIST_ADDTOINDEX"),execDone:function(){fpcm.ui_tabs.show("#files",0)}})},getCurrentPage:function(){let e=document.getElementById("pageSelect");return!e||e.options.length<2||e.value===void 0?1:e.value}}