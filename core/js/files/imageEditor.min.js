if(fpcm===void 0)var fpcm={};fpcm.imageEditor={initEditorDialog:function(e){fpcm.vars.jsvars.cropperSizes===void 0&&(fpcm.vars.jsvars.cropperSizes={}),fpcm.ui_dialogs.create({id:"files-editor",title:"FILE_LIST_EDIT",class:"modal-fullscreen",modalBodyClass:"overflow-hidden",content:'<div class="fpcm ui-image-editor-cropper m-2 mw-100 h-100 overflow-hidden"><img id="fpcm-dialog-files-imgeditor" src="'+e.data.url+'"></div>',closeButton:!0,scrollable:!1,dlOnOpenAfter:function(){let e=document.getElementById("fpcm-dialog-files-imgeditor");return fpcm.filemanager.cropper=new Cropper(e,{autoCrop:!1}),!0},dlOnClose:function(){fpcm.dom.fromTag(this).remove(),fpcm.filemanager.cropper.destroy(),fpcm.vars.jsvars.cropperSizes={}},dlButtons:[{text:"FILE_LIST_EDIT_RESIZE",icon:"expand-arrows-alt",showLabel:!1,click:function(){var e=fpcm.filemanager.cropper.getCropBoxData();if(!e.width||!e.height)return!1;let t=fpcm.ui.getTextInput({value:Math.round(e.width),name:"fpcm-ui-files-editor-width",text:fpcm.ui.translate("SYSTEM_OPTIONS_NEWSSHOWMAXIMGSIZEWIDTH"),placeholder:fpcm.ui.translate("SYSTEM_OPTIONS_NEWSSHOWMAXIMGSIZEWIDTH")}),n=fpcm.ui.getTextInput({value:Math.round(e.height),name:"fpcm-ui-files-editor-height",text:fpcm.ui.translate("SYSTEM_OPTIONS_NEWSSHOWMAXIMGSIZEHEIGHT"),placeholder:fpcm.ui.translate("SYSTEM_OPTIONS_NEWSSHOWMAXIMGSIZEHEIGHT")});fpcm.ui_dialogs.create({id:"files-editor_prop",title:fpcm.ui.translate("FILE_LIST_EDIT_RESIZE"),closeButton:!0,content:'<div class="row g-0 mb-2">'+fpcm.ui.translate("FILE_LIST_EDIT_RESIZE_NOTICE")+'</div><div class="row mb-2">'+t+'</div><div class="row">'+n+"</div>",dlButtons:[{text:"GLOBAL_SAVE",icon:"save",clickClose:!0,primary:!0,click:function(){fpcm.vars.jsvars.cropperSizes={width:Math.round(parseInt(fpcm.dom.fromId("fpcm-ui-files-editor-width").val())),height:Math.round(parseInt(fpcm.dom.fromId("fpcm-ui-files-editor-height").val()))}}}],dlOnOpenAfter:function(){fpcm.dom.bindEvent("#fpcm-ui-files-editor-width","change",function(e,t){fpcm.imageEditor.calcResized(t,"fpcm-ui-files-editor-height",0)}),fpcm.dom.bindEvent("#fpcm-ui-files-editor-height","change",function(e,t){fpcm.imageEditor.calcResized(t,"fpcm-ui-files-editor-width",1)})}})}},{text:"FILE_LIST_EDIT_ZOOMOUT",icon:"search-minus",showLabel:!1,click:function(){fpcm.filemanager.cropper.zoom(-.2)}},{text:"FILE_LIST_EDIT_ZOOMIN",icon:"search-plus",showLabel:!1,click:function(){fpcm.filemanager.cropper.zoom(.2)}},{text:"FILE_LIST_EDIT_ROTATE_ANTICLOCKWISE",icon:"undo",showLabel:!1,click:function(){fpcm.filemanager.cropper.rotate(-10)}},{text:"FILE_LIST_EDIT_ROTATE_CLOCKWISE",icon:"redo",showLabel:!1,click:function(){fpcm.filemanager.cropper.rotate(10)}},{text:"FILE_LIST_EDIT_MOVE",icon:"arrows-alt",showLabel:!1,click:function(){fpcm.filemanager.cropper.setDragMode("move")}},{text:"FILE_LIST_EDIT_CROP",icon:"crop-alt",showLabel:!1,click:function(){fpcm.filemanager.cropper.setDragMode("crop")}},{text:"GLOBAL_RESET",icon:"undo",showLabel:!1,click:function(){fpcm.filemanager.cropper.reset()}},{text:"GLOBAL_SAVE",icon:"save",clickClose:!0,primary:!0,click:function(){fpcm.filemanager.cropper.getCroppedCanvas(fpcm.vars.jsvars.cropperSizes).toBlob(t=>{const n=new FormData;n.append("file",t,e.data.filename),fpcm.ajax.post("editor/imgupload",{data:n,processData:!1,contentType:!1,execDone:function(t){e.afterUpload(t),fpcm.vars.jsvars.cropperSizes={}}})},e.data.mime)}}]})},calcResized:function(e,t,n){var s=fpcm.filemanager.cropper.getCropBoxData();if(!s.width||!s.height)return!1;let o=n?s.width/s.height:s.height/s.width;fpcm.dom.fromId(t).val(Math.round(e.value*o))}}