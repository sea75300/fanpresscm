/*
 (c) 2015-2018, Stefan Seehafer
 @license http://www.gnu.org/licenses/gpl.txt GPLv3
*/
if(void 0===fpcm)var fpcm={};
fpcm.ui={_intVars:{},init:function(){fpcm.ui._intVars.msgEl=fpcm.dom.fromId("fpcm-messages");fpcm.ui.showMessages();fpcm.ui.messagesInitClose();fpcm.ui.tabs(".fpcm-ui-tabs-general");fpcm.ui.initJqUiWidgets();fpcm.ui.spinner("input.fpcm-ui-spinner");fpcm.ui.datepicker("input.fpcm-ui-datetime-picker");fpcm.ui.accordion(".fpcm-tabs-accordion");fpcm.ui.initDateTimeMasks();fpcm.dom.fromClass("fpcm-navigation-noclick").click(function(){fpcm.ui_loader.hide();return!1});fpcm.dom.fromId("fpcm-clear-cache").click(function(){return fpcm.system.clearCache()});fpcm.dom.fromClass("fpcm-loader").click(function(){var a=
fpcm.dom.fromTag(this);if(a.hasClass("fpcm-navigation-noclick")||a.data("hidespinner"))return!1;fpcm.ui_loader.show()});fpcm.dom.fromId("fpcm-ui-form").submit(function(){fpcm.ui_loader.show();return!0});fpcm.vars.jsvars.fieldAutoFocus&&fpcm.ui.setFocus(fpcm.vars.jsvars.fieldAutoFocus)},initJqUiWidgets:function(){fpcm.dom.fromClass("fpcm-ui-button.fpcm-ui-button-confirm").unbind("click");fpcm.ui.mainToolbar=fpcm.ui.controlgroup("#fpcm-ui-toolbar div.fpcm-ui-toolbar",{onlyVisible:!0});fpcm.ui.assignControlgroups();
fpcm.dom.fromClass("fpcm-ui-button.fpcm-ui-button-confirm").click(function(){fpcm.ui_loader.hide();if(!confirm(fpcm.ui.translate("CONFIRM_MESSAGE")))return fpcm.ui_loader.hide(),!1;fpcm.dom.fromTag(this).data("hidespinner")||fpcm.ui_loader.show()});fpcm.ui.selectmenu(".fpcm-ui-input-select");fpcm.ui.assignCheckboxes();fpcm.ui.articleActionsOkButton();fpcm.ui.initPager()},translate:function(a){return void 0===fpcm.vars.ui.lang[a]?a:fpcm.vars.ui.lang[a]},langvarExists:function(a){return void 0===fpcm.vars.ui.lang[a]?
!1:!0},articleActionsOkButton:function(){var a=fpcm.dom.fromClass("fpcm-ui-articleactions-ok");a.unbind("click");a.click(function(){for(var a in fpcm)if("function"===typeof fpcm[a].assignActions&&-1===fpcm[a].assignActions())return!1;if(!confirm(fpcm.ui.translate("CONFIRM_MESSAGE")))return!1})},assignControlgroups:function(){fpcm.ui.controlgroup("div.fpcm-ui-controlgroup",{onlyVisible:!1})},assignCheckboxes:function(){var a=fpcm.dom.fromId("fpcm-select-all");if(!a.length)return!1;a.unbind("click");
a.click(function(){var a=fpcm.dom.fromClass("fpcm-ui-list-checkbox-sub");a.prop("checked",!1);fpcm.vars.jsvars.checkboxRefresh&&a.checkboxradio("refresh");a=fpcm.dom.fromClass("fpcm-ui-list-checkbox");a.prop("checked",fpcm.dom.fromTag(this).prop("checked")?!0:!1);fpcm.vars.jsvars.checkboxRefresh&&a.checkboxradio("refresh")});a=fpcm.dom.fromClass("fpcm-ui-list-checkbox-sub");if(!a.length)return!1;a.unbind("click");a.click(function(){var a=fpcm.dom.fromClass("fpcm-ui-list-checkbox-subitem"+fpcm.dom.fromTag(this).val());
a.prop("checked",fpcm.dom.fromTag(this).prop("checked")?!0:!1);fpcm.vars.jsvars.checkboxRefresh&&a.checkboxradio("refresh")})},assignSelectmenu:function(){fpcm.ui.selectmenu(".fpcm-ui-input-select")},accordion:function(a,b){a=fpcm.dom.fromTag(a);if(a.length)return void 0===b&&(b={header:"h2",heightStyle:"content"}),a.accordion(b)},tabs:function(a,b){void 0===b&&(b={});var c=fpcm.dom.fromTag(a);if(c.length){b.addMainToobarToggle&&(b.beforeActivate=function(a,c){fpcm.ui.updateMainToolbar(c);b.addMainToobarToggleAfter&&
b.addMainToobarToggleAfter(a,c)});b.saveActiveTab&&(b.activate=function(a,c){fpcm.vars.jsvars.activeTab=fpcm.dom.fromTag(this).tabs("option","active");fpcm.dom.fromId("activeTab").val(fpcm.vars.jsvars.activeTab);fpcm.ui.updateMainToolbar(c);b.saveActiveTabAfter&&b.saveActiveTabAfter(a,c)},b.create=function(a,c){fpcm.ui.updateMainToolbar(c);b.saveActiveTabAfterInit&&b.saveActiveTabAfterInit(a,c)});b.initDataViewJson&&(b.beforeLoad=function(a,c){fpcm.ui_loader.show();tabList=c.tab.data("dataview-list");
if(!tabList)return!0;b.initDataViewJsonBeforeLoad&&b.initDataViewJsonBefore(a,c);b.dataFilterParams||(b.dataFilterParams=function(a){this.dataTypes=["html","text"];return a});c.ajaxSettings.dataTypes=["json"];c.ajaxSettings.accepts="application/json";c.ajaxSettings.dataFilter=b.dataFilterParams;c.jqXHR.done(function(a){if("object"!==typeof a||!a.dataViewVars)return!0;fpcm.vars.jsvars.dataviews[tabList]=a.dataViewVars;b.initbeforeLoadDone&&b.initbeforeLoadDone(a);return!0});c.jqXHR.fail(function(a,
b,c){console.error(fpcm.ui.translate("AJAX_RESPONSE_ERROR"));console.error("STATUS MESSAGE: "+b);console.error("ERROR MESSAGE: "+c);fpcm.ajax.showAjaxErrorMessage();fpcm.ui_loader.hide()})},b.load=function(a,c){var d=c.tab.data("dataview-list");if(!d)return!0;if(!fpcm.vars.jsvars.dataviews[d])return!1;b.initDataViewJsonBefore&&b.initDataViewJsonBefore(a,c);c.panel.append(fpcm.dataview.getDataViewWrapper(d,b.dataViewWrapperClass?b.dataViewWrapperClass:""));fpcm.dataview.updateAndRender(d,{onRenderAfter:b.initDataViewOnRenderAfter});
b.initDataViewJsonAfter&&b.initDataViewJsonAfter(a,c);fpcm.ui_loader.hide();return!1});var d=c.tabs(b);b.addTabScroll&&(c.find("ul.ui-tabs-nav").wrap('<div class="fpcm-tabs-scroll"></div>'),fpcm.ui.initTabsScroll(a),fpcm.dom.fromWindow().resize(function(){fpcm.ui.initTabsScroll(a,!0)}));return d}},spinner:function(a,b){a=fpcm.dom.fromTag(a);a.length&&(void 0===b&&(b={}),b.removeCornerLeft&&(b.classes={"ui-spinner":"fpcm-ui-border-radius-right"}),a.spinner(b))},datepicker:function(a,b){a=fpcm.dom.fromTag(a);
if(a.length){void 0===b&&(b={});b.showButtonPanel=!0;b.showOtherMonths=!0;b.selectOtherMonths=!0;b.monthNames=fpcm.vars.ui.lang.calendar.months;b.dayNames=fpcm.vars.ui.lang.calendar.days;b.dayNamesShort=fpcm.vars.ui.lang.calendar.daysShort;b.dayNamesMin=fpcm.vars.ui.lang.calendar.daysShort;b.firstDay=1;b.dateFormat="yy-mm-dd";var c=a.data();c.mindate&&(b.minDate=c.mindate);c.maxdate&&(b.maxDate=c.maxdate);a.datepicker(b)}},selectmenu:function(a,b){var c=fpcm.dom.fromTag(a);if(!c.length)return!1;void 0===
b&&(b={});"#"===a.substr(0,1)&&(c=fpcm.dom.fromTag(a).data("width"))&&(b.width=c);void 0===b.width&&(b.width=300);c=fpcm.dom.fromTag(a).selectmenu(b);(b.removeCornerLeft||"#"===a.substr(1,1)&&c.data("remove_corner_left"))&&c.selectmenu("option","classes.ui-selectmenu-button","fpcm-ui-border-radius-right");b.doRefresh&&c.selectmenu("refresh");return c},checkboxradio:function(a,b,c){a=fpcm.dom.fromTag(a);a.length&&(void 0===b&&(b={}),void 0===b.icon&&(b.icon=!0),a.checkboxradio(b),void 0!==c&&a.click(c))},
controlgroup:function(a,b){void 0===b&&(b={});a=fpcm.dom.fromTag(a);if(!a.length)return!1;a=a.controlgroup(b);b.removeLeftBorderRadius&&a.find(".ui-controlgroup-item").first().removeClass("ui-corner-left");b.removeRightBorderRadius&&a.find(".ui-controlgroup-item").first().removeClass("ui-corner-right");return a},button:function(a,b,c){void 0===b&&(b={});fpcm.dom.fromTag(a).button(b);void 0!==c&&fpcm.dom.fromTag(a).click(c)},progressbar:function(a,b){void 0===b&&(b={});return fpcm.dom.fromTag(a).progressbar(b)},
dialog:function(a){void 0===a.title&&(a.title="");void 0===a.id&&(a.id=(new Date).getTime());if(void 0===a.dlWidth){var b=fpcm.ui.getDialogSizes();a.dlWidth=b.width}void 0===a.modal&&(a.modal=!0);void 0===a.resizable&&(a.resizable=!1);b="fpcm-dialog-"+a.id;void 0!==a.content&&fpcm.dom.appendHtml("#fpcm-body",'<div class="fpcm-ui-dialog-layer fpcm-editor-dialog" id="'+b+'">'+a.content+"</div>");b=fpcm.dom.fromId(b);if(!b.length)return!1;a.defaultCloseEmpty?a.dlOnClose=function(){fpcm.dom.fromTag(this).dialog("close");
fpcm.dom.fromTag(this).empty();return!1}:a.defaultClose&&(a.dlOnClose=function(){fpcm.dom.fromTag(this).dialog("close");return!1});var c={};c.width=a.dlWidth;c.modal=a.modal;c.resizable=a.resizable;c.title=a.title;c.buttons=a.dlButtons;c.open=a.dlOnOpen;c.close=a.dlOnClose;void 0!==a.dlHeight&&(c.height=a.dlHeight);void 0!==a.dlMinWidth&&(c.minWidth=a.dlMinWidth);void 0!==a.dlMinHeight&&(c.minHeight=a.dlMinHeight);void 0!==a.dlMaxWidth&&(c.maxWidth=a.dlMaxWidth);void 0!==a.dlMaxHeight&&(c.maxHeight=
a.dlMaxHeight);void 0!==a.dlPosition&&(c.position=a.dlPosition);void 0!==a.onResize&&(c.resize=a.onResize);c.show=!0;c.hide=!0;return b.dialog(c)},autocomplete:function(a,b){a=fpcm.dom.fromTag(a);if(!a.length)return!1;void 0===b.minLength&&(b.minLength=0);return a.autocomplete(b)},getDialogSizes:function(a,b){void 0===a&&(a=top);win_with=fpcm.dom.fromTag(a).width();700>=win_with?b=.95:void 0===b&&1024>=win_with?b=.65:void 0===b&&(b=.5);return{width:fpcm.dom.fromTag(top).width()*b,height:fpcm.dom.fromTag(top).height()*
b}},showMessages:function(){if(void 0===window.fpcm.vars.ui.messages||!fpcm.vars.ui.messages.length)return!1;for(var a,b,c=0;c<window.fpcm.vars.ui.messages.length;c++)a=fpcm.vars.ui.messages[c],b="msgbox-"+a.id,0<fpcm.dom.fromId(b).length||(msgCode='<div class="row fpcm-message-box fpcm-message-'+a.type+'" id="'+b+'">',msgCode+='    <div class="col-12 col-sm-11 fpcm-ui-padding-none-lr">',msgCode+='        <div class="row">',msgCode+='            <div class="col-12 col-sm-auto align-self-center fpcm-ui-center fpcm-ui-padding-none-lr">',
msgCode+="                "+fpcm.ui.getIcon(a.icon,{stack:"square fa-inverse",size:"2x"}),msgCode+="            </div>",msgCode+='            <div class="col-12 col-sm-10 align-self-center fpcm-ui-ellipsis">'+a.txt+"</div>",msgCode+="        </div>",msgCode+="    </div>",msgCode+='    <div class="col-12 col-sm-1 fpcm-ui-padding-none-lr fpcm-ui-messages-close fpcm-ui-align-right" id="msgclose-'+a.id+'">',msgCode+="                "+fpcm.ui.getIcon("times",{stack:"square fa-inverse"}),msgCode+="    </div>",
msgCode+="</div>",fpcm.dom.appendHtml("#fpcm-messages",msgCode));fpcm.dom.fromTag("div.fpcm-message-box.fpcm-message-notice").delay(1E3).fadeOut("slow");fpcm.dom.fromTag("div.fpcm-message-box.fpcm-message-neutral").delay(1E3).fadeOut("slow")},addMessage:function(a,b){if(void 0===fpcm.vars.ui.messages||b)fpcm.vars.ui.messages=[],fpcm.ui._intVars.msgEl.empty();if(!a.icon)switch(a.type){case "error":a.icon="exclamation-triangle";break;case "notice":a.icon="check";break;default:a.icon="info-circle"}a.id||
(a.id=fpcm.ui.getUniqueID());fpcm.ui.langvarExists(a.txt)?a.txt=fpcm.ui.translate(a.txt):a.txtComplete&&(a.txt=a.txtComplete);fpcm.vars.ui.messages.push(a);fpcm.ui.showMessages();fpcm.ui.messagesInitClose()},messagesInitClose:function(){fpcm.ui._intVars.msgEl.find(".fpcm-ui-messages-close").click(function(){var a=fpcm.dom.fromTag(this).attr("id");fpcm.dom.fromId("msgbox-"+a.substring(9)).fadeOut("slow")}).mouseover(function(a,b){fpcm.dom.fromTag(this).find(".fa.fa-square").removeClass("fa-inverse");
fpcm.dom.fromTag(this).find(".fa.fa-times").addClass("fa-inverse")}).mouseout(function(a,b){fpcm.dom.fromTag(this).find(".fa.fa-square").addClass("fa-inverse");fpcm.dom.fromTag(this).find(".fa.fa-times").removeClass("fa-inverse")})},setFocus:function(a){fpcm.dom.setFocus(a)},assignHtml:function(a,b){fpcm.dom.assignHtml(a,b)},assignText:function(a,b){fpcm.dom.assignText(a,b)},appendHtml:function(a,b){fpcm.dom.appendHtml(a,b)},prependHtml:function(a,b){fpcm.dom.prependHtml(a,b)},removeLoaderClass:function(a){fpcm.dom.fromTag(_id).removeClass("fpcm-loader")},
isReadonly:function(a,b){fpcm.dom.isReadonly(a,b)},createIFrame:function(a){if(!a.src)return console.warn("fpcm.ui.createIFrame requires a non-empty value."),"";a.classes||(a.classes="fpcm-ui-full-width");a.id||(a.id=fpcm.ui.getUniqueID());a.style=a.style?'style="'+a.style+'"':"";return'<iframe src="'+a.src+'" id="'+a.id+'" class="'+a.classes+'" '+a.style+"></iframe>"},getIcon:function(a,b){if(!a)return console.warn("Invalid icon class given!"),"";b||(b={});b.spinner||(b.spinner="");b.stack||(b.stack=
"");b.size||(b.size="1x");b.text||(b.text="");b.class||(b.class="");var c="unstacked";b.stack&&b.stackTop?c="stackedTop":b.stack&&!b.stackTop&&(c="stacked");return(c=fpcm.vars.ui.jsIconDummy[c]?fpcm.vars.ui.jsIconDummy[c]:"")?c.replace("{{icon}}",a).replace("{{class}}",b.class).replace("{{spinner}}",b.spinner).replace("{{stack}}",b.stack).replace("{{size}}",b.size).replace("{{text}}",b.text).replace("{{prefix}}",b.prefix?b.prefix:fpcm.vars.ui.jsIconDummy.defaultPrefix):""},initDateTimeMasks:function(){if(!fpcm.vars.jsvars.dtMasks)return!1;
fpcm.ui.autocomplete("#system_dtmask",{source:fpcm.vars.jsvars.dtMasks});fpcm.ui.autocomplete("#usermetasystem_dtmask",{source:fpcm.vars.jsvars.dtMasks})},initTabsScroll:function(a,b){var c=fpcm.dom.fromTag(a);a=c.find("ul.ui-tabs-nav");var d=c.find("div.fpcm-tabs-scroll").width();c=c.find("li.ui-tabs-tab");var e=0;jQuery.each(c,function(a,b){e+=fpcm.dom.fromTag(b).width()+5});if(a.data("fpcmtabsscrollinit")&&!b)return!0;a.data("fpcmtabsscrollinit",1);if(e<=d)return a.width("auto"),!1;a.width(parseInt(e));
return!0},getCheckboxCheckedValues:function(a){var b=[];fpcm.dom.fromTag(a+":checked").map(function(a,d){b.push(d.value)});return b},getValuesByClass:function(a,b){a=fpcm.dom.fromClass(a);if(!a.length)return{};_data=b?[]:{};a.map(function(a,d){a=fpcm.dom.fromTag(d);if(b)return _data.push(a.val()),!0;_data[a.attr("name")]=a.val();return!0});return _data},confirmDialog:function(a){var b=fpcm.ui.getDialogSizes(top,.35);a.clickNoDefault&&(a.clickNo=function(){fpcm.dom.fromTag(this).dialog("close");return!1});
fpcm.ui.dialog({title:fpcm.ui.translate("GLOBAL_CONFIRM"),content:fpcm.ui.translate("CONFIRM_MESSAGE"),dlWidth:b.width,dlButtons:[{text:fpcm.ui.translate("GLOBAL_YES"),icon:"ui-icon-check",class:a.defaultYes?"fpcm-ui-button-primary":"",click:a.clickYes},{text:fpcm.ui.translate("GLOBAL_NO"),icon:"ui-icon-closethick",class:a.defaultNo?"fpcm-ui-button-primary":"",click:a.clickNo}]})},insertDialog:function(a){var b={id:a.id,title:fpcm.ui.translate(a.title),dlWidth:a.dlWidth};void 0!==a.dlHeight&&(b.dlHeight=
a.dlHeight);void 0!==a.resizable&&(b.resizable=a.resizable);b.dlButtons=a.dlButtons?a.dlButtons:[];a.insertAction&&b.dlButtons.push({text:fpcm.ui.translate("GLOBAL_INSERT"),icon:"ui-icon-check",class:"fpcm-ui-button-primary",click:a.insertAction});a.fileManagerAction&&b.dlButtons.push({text:fpcm.ui.translate("HL_FILES_MNG"),icon:"ui-icon-folder-open",click:a.fileManagerAction});a.closeAction||(a.closeAction=function(){fpcm.dom.fromTag(this).dialog("close")});b.dlButtons.push({text:fpcm.ui.translate("GLOBAL_CLOSE"),
icon:"ui-icon-closethick",click:a.closeAction});a.dlOnOpen&&(b.dlOnOpen=a.dlOnOpen);a.dlOnClose&&(b.dlOnClose=a.dlOnClose);a.onCreate&&(b.onCreate=a.onCreate);return fpcm.ui.dialog(b)},initPager:function(a){void 0===a&&(a={});if(!fpcm.vars.jsvars.pager)return!1;var b=fpcm.dom.fromId("pagerBack"),c=fpcm.dom.fromId("pagerNext");b.unbind("click");c.unbind("click");a.backAction||(a.backAction=function(){fpcm.dom.fromTag(this).attr("href",fpcm.vars.jsvars.pager.linkString.replace("__page__",fpcm.vars.jsvars.pager.showBackButton))});
a.nextAction||(a.nextAction=function(){fpcm.dom.fromTag(this).attr("href",fpcm.vars.jsvars.pager.linkString.replace("__page__",fpcm.vars.jsvars.pager.showNextButton))});fpcm.vars.jsvars.pager.showBackButton?(b.removeClass("fpcm-ui-readonly"),b.click(a.backAction)):fpcm.vars.jsvars.pager.showBackButton||!b||b.hasClass("fpcm-ui-readonly")||b.addClass("fpcm-ui-readonly");fpcm.vars.jsvars.pager.showNextButton?(c.removeClass("fpcm-ui-readonly"),c.click(a.nextAction)):fpcm.vars.jsvars.pager.showNextButton||
!c||c.hasClass("fpcm-ui-readonly")||c.addClass("fpcm-ui-readonly");b=fpcm.dom.fromId("pageSelect");b.unbind("select");a.keepSelect||b.empty();if(fpcm.vars.jsvars.pager.maxPages)for(i=1;i<=fpcm.vars.jsvars.pager.maxPages;i++)b.append("<option "+(fpcm.vars.jsvars.pager.currentPage===i?"selected":"")+' value="'+i+'">'+fpcm.ui.translate("GLOBAL_PAGER").replace("{{current}}",i).replace("{{total}}",fpcm.vars.jsvars.pager.maxPages)+"</option>");a.selectAction||(a.selectAction=function(a,b){if(b.item.value==
fpcm.vars.jsvars.pager.currentPage)return!1;if("1"==b.item.value)return window.location.href=fpcm.vars.actionPath+fpcm.vars.jsvars.currentModule,!0;window.location.href=fpcm.vars.actionPath+fpcm.vars.jsvars.currentModule+"&page="+b.item.value});fpcm.ui.selectmenu("#pageSelect",{width:"auto",select:a.selectAction,classes:{"ui-selectmenu-button":"fpcm-ui-pager-element"},doRefresh:!0})},relocate:function(a){"self"===a&&(a=window.location.href);window.location.href=a},openWindow:function(a){return window.open(a)},
updateMainToolbar:function(a){var b=a.newTab?a.newTab:a.tab;a=a.oldTab?fpcm.dom.fromTag(a.oldTab).data("toolbar-buttons"):1;b=fpcm.dom.fromTag(b).data("toolbar-buttons");fpcm.ui.mainToolbar.find(".fpcm-ui-maintoolbarbuttons-tab"+a).addClass("fpcm-ui-hidden");fpcm.ui.mainToolbar.find(".fpcm-ui-maintoolbarbuttons-tab"+b).removeClass("fpcm-ui-hidden");fpcm.ui.controlgroup(fpcm.ui.mainToolbar,"refresh")},resetSelectMenuSelection:function(a){a=fpcm.dom.fromTag(a);a.prop("selectedIndex",0);a.val("");a.selectmenu("refresh");
return!0},showCurrentPasswordConfirmation:function(){var a=fpcm.dom.fromId("fpcm-ui-currentpass-box");if(!a.length)return!1;a.removeClass("fpcm-ui-hidden");return!0},isHidden:function(a){a instanceof Object||(a=fpcm.dom.fromTag(a));return a.hasClass("fpcm-ui-hidden")?!0:!1},getUniqueID:function(a){return(new Date).getMilliseconds()+Math.random().toString(36).substr(2,9)+(a?a:"")},testing:function(a){a||(a={});a.step||(a.step=1);fpcm.ajax.get("testing",{data:{timestamp:(new Date).getTime(),step:a.step},
cache:!1,dataType:"json",execDone:function(a){console.log(a);if(2==a.res)return!1;fpcm.ui.testing({step:a.step})}})}};