if(fpcm===void 0)var fpcm={};fpcm.updater={startTime:0,stopTime:0,elCount:[],elements:[],currentEl:{},currentIdx:0,init:function(){fpcm.updater.elements=fpcm.dom.fromClass("fpcm-ui-update-icons"),fpcm.updater.elCount=fpcm.updater.elements.length;var e=fpcm.updater.elements.first();fpcm.updater.execRequest(e)},execRequest:function(e){fpcm.updater.currentIdx++;var n={step:e.data("step"),func:e.data("func"),var:e.data("var")},t=e.parent().parent().parent();return t.addClass("list-group-item-primary").removeClass("disabled"),n.var&&fpcm.vars.jsvars.pkgdata.update[n.var]&&t.html(t.html().replace("{{var}}",fpcm.vars.jsvars.pkgdata.update[n.var])),n.func&&typeof fpcm.updater[n.func]=="function"&&fpcm.updater[n.func].call(),!!n.step&&(fpcm.updater._spinner(t,!0),fpcm.updater.currentEl=e,fpcm.ajax.post("packagemgr/processUpdate",{quiet:!0,data:{step:n.step},execDone:function(e){if(fpcm.updater._spinner(t,!1),!e.code)return t.removeClass("list-group-item-primary").removeClass("disabled").addClass("list-group-item-danger"),fpcm.updater.errorMsg(),e.message&&(fpcm.ui.addMessage(e.message),fpcm.ui_notify.show({body:e.message.txt})),fpcm.updater.currentEl={},!1;e.pkgdata instanceof Object&&jQuery.extend(fpcm.vars.jsvars.pkgdata.update,e.pkgdata);var n=fpcm.updater.currentEl.data("after");if(n&&typeof fpcm.updater[n]=="function"&&fpcm.updater[n].call(),t.removeClass("list-group-item-primary").removeClass("disabled").addClass("list-group-item-success"),!fpcm.updater.elements[fpcm.updater.currentIdx])return!1;fpcm.updater.execRequest(fpcm.dom.fromTag(fpcm.updater.elements[fpcm.updater.currentIdx]))},execFail:function(){return fpcm.updater._spinner(t,!1),t.removeClass("list-group-item-primary").removeClass("disabled").addClass("list-group-item-danger"),fpcm.ui_notify.show({body:fpcm.updater.errorMsg()}),fpcm.updater.currentEl={},!1}}),!0)},startTimer:function(){fpcm.updater.startTime=(new Date).getTime()},stopTimer:function(){fpcm.updater.stopTime=(new Date).getTime(),fpcm.dom.assignHtml("#fpcm-ui-update-timer",(fpcm.updater.stopTime-fpcm.updater.startTime)/1e3+" sec"),fpcm.dom.assignHtml("#fpcm-ui-update-newver-descr",fpcm.vars.jsvars.pkgdata.update.version);let e=fpcm.dom.fromId("fpcm-ui-update-result-1");e.removeClass("disabled d-none").addClass("list-group-item-success"),fpcm.ui_notify.show({body:e.find("div.fpcm-ui-updater-descr").text().trim()})},errorMsg:function(){let e=fpcm.dom.fromId("fpcm-ui-update-result-0");return e.removeClass("disabled d-none").addClass("list-group-item-danger"),fpcm.dom.fromId("fpcm-ui-update-timer").addClass("d-none"),fpcm.dom.fromId("fpcm-ui-update-version").addClass("d-none"),e.find("div.fpcm-ui-updater-descr").text().trim()},_spinner:function(e,t){e.find("div.fpcm.ui-updater-spinner").html(t?'<div class="spinner-border spinner-border-sm text-secondary" role="status"></div>':"")}}