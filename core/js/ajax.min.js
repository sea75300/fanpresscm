/*
 (c) 2015-2018, Stefan Seehafer
 @license http://www.gnu.org/licenses/gpl.txt GPLv3
 @since FPCM 3.5
*/
if(void 0===fpcm)var fpcm={};
fpcm.ajax={exec:function(b,a){a||(a={});a.method||(a.method="POST");void 0===a.async&&(a.async=!0);a.data||(a.data=[]);a.execDone||(a.execDone=!1);a.execFail||(a.execFail=!1);a.pageToken&&(a.data._token=fpcm.vars.jsvars.pageTokens[a.pageToken]?fpcm.vars.jsvars.pageTokens[a.pageToken]:null);a.quiet||fpcm.ui_loader.show(a.loaderMsg?a.loaderMsg:null);jQuery.ajax({url:fpcm.vars.ajaxActionPath+b,type:a.method.toUpperCase(),data:a.data,async:a.async,dataType:a.dataType?a.dataType:null,cache:void 0!==a.cache?
a.cache:!0,processData:void 0!==a.processData?a.processData:!0,contentType:void 0!==a.contentType?a.contentType:"application/x-www-form-urlencoded; charset=UTF-8",statusCode:{500:function(){fpcm.ajax.showAjaxErrorMessage();fpcm.ui_loader.hide()},400:function(){fpcm.ui.addMessage({txt:"CSRF_INVALID",type:"error"});fpcm.ui_loader.hide()},401:function(){fpcm.system.showSessionCheckDialog();fpcm.ui_loader.hide()},404:function(){fpcm.ajax.showAjaxErrorMessage();fpcm.ui_loader.hide()}}}).done(function(b){b.search&&
3===b.search("FATAL ERROR:")&&(console.error(fpcm.ui.translate("AJAX_RESPONSE_ERROR")),console.error("ERROR MESSAGE: "+errorThrown),fpcm.ui_loader.hide());if(void 0!==b.cmd)return eval(b.cmd),!0;"string"==typeof a.execDone&&eval(a.execDone);"function"==typeof a.execDone&&a.execDone(b);a.quiet||fpcm.ui_loader.hide()}).fail(function(b,e,c){"parsererror"==e&&(fpcm.ajax.showAjaxErrorMessage(),fpcm.ui_loader.hide());console.error(fpcm.ui.translate("AJAX_RESPONSE_ERROR"));console.error("STATUS MESSAGE: "+
e);console.error("ERROR MESSAGE: "+c);fpcm.ui_loader.hide();"string"==typeof a.execFail&&eval(a.execFail);"function"==typeof a.execFail&&a.execFail()})},get:function(b,a){a||(a={});a.method="GET";fpcm.ajax.exec(b,a)},post:function(b,a){a||(a={});a.method="POST";fpcm.ajax.exec(b,a)},fromJSON:function(b){return b instanceof Object||b instanceof Array?b:JSON.parse(b)},toJSON:function(b){var a=b instanceof Object?!0:!1;return b instanceof Array||a?JSON.stringify(b):""},showAjaxErrorMessage:function(){fpcm.ui.addMessage({txt:"AJAX_RESPONSE_ERROR",
type:"error"},!0)},execFunction:function(b,a,d){d.data.fn=a;d.dataType="json";fpcm.ajax.post(b,d)},getItemList:function(b){if(!b.module)return console.error("Invalid module given."),!1;b.dataType||(b.dataType="json");let a={mode:b.mode?b.mode:null,page:void 0!==b.page?parseInt(b.page):1};b.filter instanceof Object&&(a.filter=b.filter);fpcm.ajax.post(b.module+"/lists",{data:a,quiet:void 0!==a.filter&&null!==a.filter||b.loader?!1:!0,execDone:function(a){if(!a)return!1;if("json"!==b.dataType)return fpcm.dom.assignHtml(b.destination,
a),b.onAssignHtmlAfter(),!0;if(a.message&&a.message.txt&&a.message.type)return fpcm.ui.addMessage(a.message),!1;fpcm.vars.jsvars.dataviews[a.dataViewName]=a.dataViewVars;fpcm.dataview.updateAndRender(a.dataViewName,{onRenderAfter:b.onRenderDataViewAfter});b.filter?(fpcm.ui.mainToolbar.find(".fpcm-ui-pager-element").addClass("fpcm-ui-hidden"),fpcm.ui.controlgroup(fpcm.ui.mainToolbar,"refresh"),fpcm.dom.fromId("opensearch").addClass("fpcm-ui-button-primary")):a.pager&&!b.filter&&(fpcm.ui.mainToolbar.find(".fpcm-ui-pager-element").removeClass("fpcm-ui-hidden"),
fpcm.ui.controlgroup(fpcm.ui.mainToolbar,"refresh"),fpcm.dom.fromId("opensearch").removeClass("fpcm-ui-button-primary"),fpcm.vars.jsvars.pager.currentPage=a.pager.currentPage,fpcm.vars.jsvars.pager.maxPages=a.pager.maxPages,fpcm.vars.jsvars.pager.showBackButton=a.pager.showBackButton,fpcm.vars.jsvars.pager.showNextButton=a.pager.showNextButton,fpcm.ui.initPager({nextAction:function(a,c){if(!fpcm.vars.jsvars.pager.showNextButton||fpcm.vars.jsvars.pager.currentPage>=fpcm.vars.jsvars.pager.maxPages)return!1;
b.onPagerNext(a,c);return!0},backAction:function(a,c){if(!fpcm.vars.jsvars.pager.showBackButton)return!1;b.onPagerBack(a,c);return!0},selectAction:function(a,c){if(c.item.value==fpcm.vars.jsvars.pager.currentPage)return!1;b.onPagerSelect(a,c);return!0}}));return!0}})}};