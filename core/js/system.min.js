if(fpcm===void 0)var fpcm={};fpcm.system={init:function(){fpcm.worker.postMessage({namespace:'system',function:'doRefresh',interval:6e4,id:'system.refresh'}),fpcm.system.initPasswordFieldActions(),fpcm.system.showHelpDialog();let a=fpcm.dom.fromId('fpcm-clear-cache');a.unbind('click'),a.click(function(){return fpcm.system.clearCache()})},togglePasswordField:function(d,c){let a=c.parentNode.querySelector('input'),b={password:'text',text:'password'};a.type=b[a.type]?b[a.type]:'password'},initPasswordFieldActions:function(){fpcm.dom.fromId('password_confirm').focusout(function(){var a=fpcm.dom.fromId('password').val(),b=fpcm.dom.fromTag(this).val();return a!=b&&fpcm.ui.addMessage({type:'error',txt:fpcm.ui.translate('SAVE_FAILED_PASSWORD_MATCH')},!0),fpcm.ui.showCurrentPasswordConfirmation(),fpcm.ajax.post('passcheck',{quiet:!0,data:{password:a},execDone:function(a){return a.code!=0&&(fpcm.ui.addMessage({type:'error',txt:fpcm.ui.translate('SAVE_FAILED_PASSWORD_SECURITY_PWNDPASS')},!0),!1)}}),!1}),fpcm.dom.fromId('genPasswd').click(function(){return fpcm.system.generatePasswdString(),fpcm.ui.showCurrentPasswordConfirmation(),!1})},showSessionCheckDialog:function(){if(!fpcm.vars.jsvars.sessionCheck)return!0;fpcm.ui_notify.show({body:'SESSION_TIMEOUT',timeout:-1,click:function(a){window.focus()}}),fpcm.ui.dialog({content:fpcm.ui.translate('SESSION_TIMEOUT'),dlButtons:buttons=[{text:fpcm.ui.translate('GLOBAL_YES'),icon:"ui-icon-check",click:function(){fpcm.ui.relocate(fpcm.vars.actionPath+'system/login'),fpcm.dom.fromTag(this).dialog('close')}},{text:fpcm.ui.translate('GLOBAL_NO'),icon:"ui-icon-closethick",click:function(){fpcm.vars.jsvars.sessionCheck=!0,fpcm.dom.fromTag(this).dialog('close'),fpcm.dom.fromTag(this).remove()}}],id:'sessioncheck'}),fpcm.vars.jsvars.sessionCheck=!1},doRefresh:function(){return!fpcm.vars.jsvars.noRefresh&&(fpcm.ajax.post('refresh',{quiet:!0,data:{articleId:fpcm.vars.jsvars.articleId},execDone:function(a){fpcm.worker.postMessage({cmd:'remove',id:'system.refresh'}),fpcm.vars.jsvars.articleId==1&&fpcm.editor.showInEditDialog(a),a.sessionCode==0&&fpcm.vars.jsvars.sessionCheck&&fpcm.system.showSessionCheckDialog()}}),!0)},generatePasswdString:function(){var a=nkorgPassGen.getPassword(6);return fpcm.dom.fromId('password').val(a),fpcm.dom.fromId('password_confirm').val(a),!1},initMassEditDialog:function(f,c,d,a){var b,e;return a===void 0&&(a={}),b='#fpcm-dialog-'+c,fpcm.ui.selectmenu('.fpcm-ui-input-select-massedit',{appendTo:b}),typeof d.initWidgets=='function'&&d.initWidgets(b),e=fpcm.ui.getDialogSizes(),fpcm.ui.dialog({id:c,dlWidth:e.width,resizable:!0,title:fpcm.ui.translate('GLOBAL_EDIT_SELECTED'),dlButtons:[{text:fpcm.ui.translate('GLOBAL_SAVE'),icon:"ui-icon-check",class:'btn-primary',click:function(){fpcm.ui.confirmDialog({defaultYes:!0,clickYes:function(){var c=fpcm.ui.getCheckboxCheckedValues('.fpcm-ui-list-checkbox'),b,d;if(c.length==0)return fpcm.ui_loader.hide(),!1;b={fields:fpcm.ui.getValuesByClass('fpcm-ui-input-massedit'),ids:fpcm.ajax.toJSON(c)},a.multipleSelect?b.fields[a.multipleSelectField]=fpcm.dom.fromId(a.multipleSelect).val():(d=fpcm.dom.fromId('categories'),d&&(b.fields.categories=d.val())),a.onSuccess&&(b.onSuccess=a.onSuccess),fpcm.system.execMassEdit(f,b),fpcm.dom.fromTag(this).dialog('close')},clickNo:function(){fpcm.dom.fromTag(this).dialog('close')}})}},{text:fpcm.ui.translate('GLOBAL_CLOSE'),icon:"ui-icon-closethick",click:function(){fpcm.dom.fromTag(this).dialog('close')}}],dlOnClose:function(b,c){let a=fpcm.dom.fromId('categories');a[0]&&a[0].selectize.clear(),fpcm.ui_loader.hide()}}),!1},execMassEdit:function(b,a){a.onSuccess||(a.onSuccess=function(){fpcm.ui.relocate(window.location.href+(fpcm.vars.jsvars.massEdit&&fpcm.vars.jsvars.massEdit.relocateParams?fpcm.vars.jsvars.massEdit.relocateParams:''))}),fpcm.ajax.post(b,{data:a,dataType:'json',execDone:function(b){if(b!==null&&b.code==1)return a.onSuccess(),!0;fpcm.ui.addMessage({type:'error',id:'fpcm-articles-massedit',icon:'exclamation-triangle',txt:fpcm.vars.jsvars.massEditSaveFailed},!0)}})},clearCache:function(a){return a||(a={}),fpcm.ajax.post('cache',{data:a,execDone:function(a){fpcm.ui.addMessage(a,!0)}}),!1},emptyTrash:function(a){return fpcm.ui.confirmDialog({clickYes:function(){fpcm.ajax.execFunction('clearTrash',a.fn,{pageToken:'ajax/clearTrash',data:{ids:a.ids?a.ids:[]},execDone:function(a){if(fpcm.ui.resetSelectMenuSelection('action'),!a.msg&&!a.code)return fpcm.ajax.showAjaxErrorMessage(),fpcm.ui_loader.hide(),!1;if(fpcm.ui.addMessage(a.msg,!0),a.code==1)return setTimeout(function(){window.location.reload()},2500),!0}}),fpcm.dom.fromTag(this).dialog("close")},clickNoDefault:!0}),!1},showHelpDialog:function(){fpcm.dom.fromClass('fpcm-ui-help-dialog').click(function(){var a=fpcm.dom.fromTag(this);return fpcm.ajax.get('help',{quiet:!0,data:{ref:a.data('ref'),chapter:a.data('chapter')},execDone:function(a){var b=fpcm.ui.getDialogSizes(top,.9);fpcm.ui.dialog({id:'help',title:fpcm.ui.translate('HL_HELP'),content:a,dlButtons:[{text:'GLOBAL_CLOSE',icon:"times",clickClose:!0,primary:!0}]})}}),!1})},checkForUpdates:function(){return fpcm.dom.fromId('checkUpdate').click(function(){fpcm.ajax.get('cronasync',{data:{cjId:'updateCheck'}})}),!0},mergeToVars:function(a){return a||(a=[]),jQuery.extend(fpcm,a)},parseUrlQuery:function(e){var b,c,a,d;if(!e)return{};b=e.replace(/.*\?/,'').split('&'),c={};for(a=0;a<b.length;a++){if(b[a]===void 0)continue;d=b[a].split(/([a-zA-Z0-9]+)\=(.*)/),c[d[1]]=d[2]}return c}}