if(fpcm===void 0)var fpcm={};fpcm.system={init:function(){fpcm.worker.postMessage({namespace:"system",function:"doRefresh",interval:6e4,id:"system.refresh"}),fpcm.system.initPasswordFieldActions(),fpcm.system.showHelpDialog(),fpcm.dom.bindClick("#fpcm-clear-cache",function(){return fpcm.system.clearCache()})},togglePasswordField:function(e,t){let n=t.parentNode.parentNode.querySelector("input"),s={password:"text",text:"password"};n.type=s[n.type]?s[n.type]:"password"},initPasswordFieldActions:function(){fpcm.dom.fromId("password_confirm").focusout(function(){var e=fpcm.dom.fromId("password").val(),t=fpcm.dom.fromTag(this).val();return e!=t&&fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate("SAVE_FAILED_PASSWORD_MATCH")},!0),fpcm.ui.showCurrentPasswordConfirmation(),fpcm.ajax.post("passcheck",{quiet:!0,data:{password:e},execDone:function(e){return e.code!=0&&(fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate("SAVE_FAILED_PASSWORD_SECURITY_PWNDPASS")},!0),!1)}}),!1}),fpcm.dom.bindClick("#genPasswd",function(){return fpcm.system.generatePasswdString(),fpcm.ui.showCurrentPasswordConfirmation(),!1})},showSessionCheckDialog:function(){if(!fpcm.vars.jsvars.sessionCheck)return!0;fpcm.ui_notify.show({body:"SESSION_TIMEOUT",timeout:-1,click:function(){window.focus()}}),fpcm.ui_dialogs.create({id:"sessioncheck",content:fpcm.ui.translate("SESSION_TIMEOUT"),dlButtons:buttons=[{text:"GLOBAL_YES",icon:"check",clickClose:!0,primary:!0,click:function(){fpcm.ui.relocate(fpcm.vars.actionPath+"system/login")}},{text:"GLOBAL_NO",icon:"times",clickClose:!0,click:function(){fpcm.vars.jsvars.sessionCheck=!0}}]}),fpcm.vars.jsvars.sessionCheck=!1},doRefresh:function(){return!fpcm.vars.jsvars.noRefresh&&(fpcm.ajax.post("refresh",{quiet:!0,async:!0,data:{articleId:fpcm.vars.jsvars.articleId},execDone:function(e){fpcm.worker.postMessage({cmd:"remove",id:"system.refresh"}),fpcm.vars.jsvars.articleId>0&&fpcm.editor.showInEditDialog(e),e.sessionCode==0&&fpcm.vars.jsvars.sessionCheck&&fpcm.system.showSessionCheckDialog(),e.notifications&&fpcm.system.addAjaxNotifications(e.notifications,e.notificationCount)}}),!0)},generatePasswdString:function(){var e=nkorgPassGen.getPassword(6);return fpcm.dom.fromId("password").val(e),fpcm.dom.fromId("password_confirm").val(e),!1},initMassEditDialog:function(e,t,n,s){s===void 0&&(s={});var o,a,r="#fpcm-dialog-"+t;let i="";if(s.fields!==void 0){for(a in s.fields)i+=s.fields[a];i='<div class="mb-5">'+i+"</div>"}return o={fields:{},ids:fpcm.dom.getCheckboxCheckedValues(".fpcm-ui-list-checkbox")},!!o.ids.length&&(o.ids=fpcm.ajax.toJSON(o.ids),fpcm.ui_dialogs.create({id:t,title:"GLOBAL_EDIT_SELECTED",closeButton:!0,content:i||void 0,dlButtons:[{text:"GLOBAL_SAVE",icon:"save",primary:!0,clickClose:!0,click:function(){o.fields=fpcm.dom.getValuesByClass("fpcm-ui-input-massedit");var t=fpcm.dom.fromId("categories");t.length&&(n.massEditCategories=t.val()),s.multipleSelect?o.fields[s.multipleSelectField]=fpcm.dom.fromId(s.multipleSelect).val():(o.fields.categories=n.massEditCategories,n.massEditCategories=[]),fpcm.ui_dialogs.confirm({defaultYes:!0,clickYes:function(){s.onSuccess&&(o.onSuccess=s.onSuccess),fpcm.system.execMassEdit(e,o)}})}}],dlOnOpenAfter:function(){typeof n.initWidgets=="function"&&n.initWidgets()},dlOnClose:function(){typeof n.onMassEditorDialogClose=="function"&&n.onMassEditorDialogClose(),fpcm.ui_loader.hide()}}),!1)},execMassEdit:function(e,t){t.onSuccess||(t.onSuccess=function(){if(fpcm.vars.jsvars.massEdit===void 0||!fpcm.vars.jsvars.massEdit.relocateParams===void 0){setTimeout(function(){window.location.reload()},1e3);return}fpcm.ui.relocate(window.location.href+fpcm.vars.jsvars.massEdit.relocateParams)}),fpcm.ajax.post(e,{data:t,dataType:"json",execDone:function(e){if(e!==null&&e.code==1)return t.onSuccess(),!0;fpcm.ui.addMessage({type:"error",id:"fpcm-articles-massedit",icon:"exclamation-triangle",txt:fpcm.vars.jsvars.massEditSaveFailed},!0)}})},clearCache:function(e){return e||(e={}),fpcm.ajax.post("cache",{data:e,execDone:function(e){fpcm.ui.addMessage(e,!0)}}),!1},emptyTrash:function(e){return fpcm.ui_dialogs.confirm({clickYes:function(){fpcm.ajax.execFunction("clearTrash",e.fn,{pageToken:"ajax/clearTrash",data:{ids:e.ids?e.ids:[]},execDone:function(e){if(fpcm.dom.resetValuesByIdsSelect("action"),!e.msg&&!e.code)return fpcm.ajax.showAjaxErrorMessage(),fpcm.ui_loader.hide(),!1;if(fpcm.ui.addMessage(e.msg,!0),e.code==1)return setTimeout(function(){window.location.reload()},2500),!0}})}}),!1},showHelpDialog:function(){fpcm.dom.bindClick(".fpcm.ui-help-dialog",function(e,t){return fpcm.ajax.get("help",{quiet:!0,data:{ref:t.dataset.ref,chapter:t.dataset.chapter},execDone:function(e){fpcm.ui_dialogs.create({id:"help",title:"HL_HELP",size:"xl",content:e,closeButton:!0,headlines:!0,dlOnOpenAfter:function(e){fpcm.ui_dialogs.initScrollspy(e.id)}})}}),!1})},addAjaxNotifications:function(e,t){let n="#fpcm-id-notifications";if(!fpcm.dom.fromId(n).length)return!1;fpcm.dom.assignHtml(n,e);let s=fpcm.dom.fromId("notificationsCount").html(t);if(t)return s.removeClass("d-none"),!0;s.addClass("d-none")},checkForUpdates:function(){return fpcm.dom.fromId("checkUpdate").click(function(){fpcm.ajax.get("cronasync",{data:{cjId:"updateCheck"}})}),!0},mergeToVars:function(e){return e||(e=[]),jQuery.extend(fpcm,e)},parseUrlQuery:function(e){if(!e)return{};for(var s,n=e.replace(/.*\?/,"").split("&"),o={},t=0;t<n.length;t++){if(n[t]===void 0)continue;s=n[t].split(/([a-zA-Z0-9]+)=(.*)/),o[s[1]]=s[2]}return o}}