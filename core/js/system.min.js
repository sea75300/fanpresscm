if(fpcm===void 0)var fpcm={};fpcm.system={init:function(){fpcm.worker.postMessage({namespace:"system",function:"doRefresh",interval:6e4,id:"system.refresh"}),fpcm.system.initPasswordFieldActions(),fpcm.system.showHelpDialog(),fpcm.dom.bindClick("#fpcm-clear-cache",function(){return fpcm.system.clearCache()}),fpcm.dom.bindClick("#btnMinifyMenu",function(e){let n=[{text:"GLOBAL_HIDE",icon:"fa-chevron-left"},{text:"GLOBAL_SHOW",icon:"fa-chevron-right"}];fpcm.dom.fromTag("a.fpcm.ui-nav-link.nav-link > span.fpcm.nav-text").toggleClass("d-lg-none"),fpcm.dom.fromTag("a.fpcm.ui-nav-link.nav-link").toggleClass("text-center"),e.currentTarget.dataset.navhidden=parseInt(e.currentTarget.dataset.navhidden)?0:1;let t=n[e.currentTarget.dataset.navhidden];if(!t)return!1;e.currentTarget.title=fpcm.ui.translate(t.text),e.delegateTarget.childNodes[0].classList.replace(e.delegateTarget.childNodes[0].classList[3],t.icon)}),fpcm.dom.bindClick("button[data-toolbar-name]",function(e){if(!e.delegateTarget)return!1;if(!e.delegateTarget.dataset)return!1;if(!e.delegateTarget.dataset.toolbarName)return!1;let t=document.createElement("input");t.value=e.delegateTarget.dataset.toolbarName,t.id="tmp"+e.delegateTarget.dataset.toolbarName,document.body.appendChild(t),document.getElementById(t.id).select(),document.execCommand("copy"),document.body.removeChild(t),fpcm.ui.addMessage(new fpcm.ui.message("info",`Area ID copied: ${t.value}`))})},togglePasswordField:function(e,t){let n=t.parentNode.parentNode.querySelector("input"),s={password:"text",text:"password"};n.type=s[n.type]?s[n.type]:"password"},initPasswordFieldActions:function(){fpcm.dom.fromId("password_confirm").focusout(function(){var e=fpcm.dom.fromId("password").val(),t=fpcm.dom.fromTag(this).val();return e!=t&&fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate("SAVE_FAILED_PASSWORD_MATCH")},!0),fpcm.ui.showCurrentPasswordConfirmation(),fpcm.ajax.post("passcheck",{quiet:!0,data:{password:e},execDone:function(e){return e.code!=0&&(fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate("SAVE_FAILED_PASSWORD_SECURITY_PWNDPASS")},!0),!1)}}),!1}),fpcm.dom.bindClick("#genPasswd",function(){return fpcm.system.generatePasswdString(),fpcm.ui.showCurrentPasswordConfirmation(),!1})},showSessionCheckDialog:function(){if(!fpcm.vars.jsvars.sessionCheck)return!0;fpcm.ui_notify.show({body:"SESSION_TIMEOUT",timeout:-1,click:function(){window.focus()}}),fpcm.ui_dialogs.create({id:"sessioncheck",content:fpcm.ui.translate("SESSION_TIMEOUT"),dlButtons:buttons=[{text:"GLOBAL_YES",icon:"check",clickClose:!0,primary:!0,click:function(){fpcm.ui.relocate(fpcm.vars.actionPath+"system/login")}},{text:"GLOBAL_NO",icon:"times",clickClose:!0,click:function(){fpcm.vars.jsvars.sessionCheck=!0}}]}),fpcm.vars.jsvars.sessionCheck=!1},doRefresh:function(){return!fpcm.vars.jsvars.noRefresh&&(fpcm.ajax.post("refresh",{quiet:!0,async:!0,data:{articleId:fpcm.vars.jsvars.articleId},execDone:function(e){fpcm.worker.postMessage({cmd:"remove",id:"system.refresh"}),fpcm.vars.jsvars.articleId>0&&fpcm.editor&&fpcm.editor.showInEditDialog&&fpcm.editor.showInEditDialog(e),e.sessionCode==0&&fpcm.vars.jsvars.sessionCheck&&fpcm.system.showSessionCheckDialog(),e.notifications&&fpcm.system.addAjaxNotifications(e.notifications,e.notificationCount)}}),!0)},generatePasswdString:function(){var e=nkorgPassGen.getPassword(6);return fpcm.dom.fromId("password").val(e),fpcm.dom.fromId("password_confirm").val(e),!1},initMassEditDialog:function(e,t,n,s){s===void 0&&(s={});var o,a,r="#fpcm-dialog-"+t;let i="";if(s.fields!==void 0){for(a in s.fields)i+=s.fields[a];i='<div class="mb-5">'+i+"</div>"}return o={fields:{},ids:fpcm.dom.getCheckboxCheckedValues(".fpcm-ui-list-checkbox")},o.ids.length?(o.ids=fpcm.ajax.toJSON(o.ids),fpcm.ui_dialogs.create({id:t,title:"GLOBAL_EDIT_SELECTED",closeButton:!0,content:i||void 0,dlButtons:[{text:"GLOBAL_SAVE",icon:"save",primary:!0,clickClose:!0,click:function(){o.fields=fpcm.dom.getValuesByClass("fpcm-ui-input-massedit");var t=fpcm.dom.fromId("categories");t.length&&(n.massEditCategories=t.val()),s.multipleSelect?o.fields[s.multipleSelectField]=fpcm.dom.fromId(s.multipleSelect).val():(o.fields.categories=n.massEditCategories,n.massEditCategories=[]),fpcm.ui_dialogs.confirm({defaultYes:!0,clickYes:function(){s.onSuccess&&(o.onSuccess=s.onSuccess),fpcm.system.execMassEdit(e,o)}})}}],dlOnOpenAfter:function(){typeof n.initWidgets=="function"&&n.initWidgets()},dlOnClose:function(){typeof n.onMassEditorDialogClose=="function"&&n.onMassEditorDialogClose(),fpcm.ui_loader.hide()}}),!1):(fpcm.ui.addMessage({type:"error",txt:"SELECT_ITEMS_MSG"},!0),!1)},execMassEdit:function(e,t){t.onSuccess||(t.onSuccess=function(){if(fpcm.vars.jsvars.massEdit===void 0||!fpcm.vars.jsvars.massEdit.relocateParams===void 0){setTimeout(function(){window.location.reload()},1e3);return}fpcm.ui.relocate(window.location.href+fpcm.vars.jsvars.massEdit.relocateParams)}),fpcm.ajax.post(e,{data:t,dataType:"json",execDone:function(e){if(e!==null&&e.code==1)return t.onSuccess(),!0;fpcm.ui.addMessage({type:"error",id:"fpcm-articles-massedit",icon:"exclamation-triangle",txt:fpcm.vars.jsvars.massEditSaveFailed},!0)}})},clearCache:function(e){return e||(e={}),fpcm.ajax.post("cache",{data:e,execDone:function(e){fpcm.ui.addMessage(e,!0)}}),!1},emptyTrash:function(e){return fpcm.ui_dialogs.confirm({clickYes:function(){fpcm.ajax.execFunction("clearTrash",e.fn,{pageToken:"ajax/clearTrash",data:{ids:e.ids?e.ids:[]},execDone:function(e){if(fpcm.dom.resetValuesByIdsSelect("action"),!e.msg&&!e.code)return fpcm.ajax.showAjaxErrorMessage(),fpcm.ui_loader.hide(),!1;if(fpcm.ui.addMessage(e.msg,!0),e.code==1)return setTimeout(function(){window.location.reload()},2500),!0}})}}),!1},showHelpDialog:function(){fpcm.dom.bindClick(".fpcm.ui-help-dialog",function(e,t){return fpcm.ajax.get("help",{quiet:!0,data:{ref:t.dataset.ref,chapter:t.dataset.chapter},execDone:function(e){fpcm.ui_dialogs.create({id:"help",title:"HL_HELP",size:"xl",content:e,closeButton:!0,headlines:!0,dlOnOpenAfter:function(e){fpcm.ui_dialogs.initScrollspy(e.id)}})}}),!1})},addAjaxNotifications:function(e,t){let n="#fpcm-id-notifications";if(!fpcm.dom.fromId(n).length)return!1;fpcm.dom.assignHtml(n,e);let s=fpcm.dom.fromId("notificationsCount").html(t);if(t)return s.removeClass("d-none"),!0;s.addClass("d-none")},checkForUpdates:function(){return fpcm.dom.bindClick("#checkUpdate",function(){fpcm.ajax.get("crons/exec",{data:{cjId:"updateCheck"}})}),!0},mergeToVars:function(e){return e||(e=[]),jQuery.extend(fpcm,e)},parseUrlQuery:function(e){if(!e)return{};for(var s,n=e.replace(/.*\?/,"").split("&"),o={},t=0;t<n.length;t++){if(n[t]===void 0)continue;s=n[t].split(/([a-zA-Z0-9]+)=(.*)/),o[s[1]]=s[2]}return o},createCopy:function(e){let t=e.delegateTarget.dataset.fnArg.split(":");fpcm.ui_dialogs.confirm({clickYes:function(){fpcm.ajax.execFunction("copy",t[0],{data:{id:t[1],dest:t[2]?t[2]:"system"},execDone:function(e){if(!e.result)return fpcm.ui.addMessage(e.message),!0;if(e.destination)return fpcm.ui.relocate(e.destination),!0;if(e.callback){let t=e.callback.split(".");return!typeof fpcm[t[0]][t[1]]!="function"&&fpcm[t[0]][t[1]]()}return!0}})}})},openUpdateDialog:function(e){fpcm.dom.bindClick("#"+e,function(e,t){fpcm.ui_dialogs.create({id:"updateCallback",title:"HL_PACKAGEMGR_SYSUPDATES",content:fpcm.ui.translate("PACKAGES_UPDATE_CONFIRM"),icon:{icon:"cloud-download"},dlButtons:[{text:"HL_HELP_CHANGELOG",icon:"code-branch",click:function(){window.open(t.dataset.changelog,"_blank")},class:"btn-info"},{text:"GLOBAL_YES",icon:"check",click:function(){fpcm.ui.relocate(t.dataset.update)},class:"btn-success"},{text:"GLOBAL_NO",icon:"times",class:"btn-danger",clickClose:!0}]})})}}