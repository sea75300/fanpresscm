/*
 (c) 2015-2018, Stefan Seehafer
 @license http://www.gnu.org/licenses/gpl.txt GPLv3
*/
if(void 0===fpcm)var fpcm={};
fpcm.system={init:function(){fpcm.worker.postMessage({namespace:"system",function:"doRefresh",interval:6E4,id:"system.refresh"});fpcm.system.initPasswordFieldActions();fpcm.system.showHelpDialog()},initPasswordFieldActions:function(){fpcm.dom.fromId("password_confirm").focusout(function(){var a=fpcm.dom.fromId("password").val(),b=fpcm.dom.fromTag(this).val();a!=b&&fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate("SAVE_FAILED_PASSWORD_MATCH")},!0);fpcm.ui.showCurrentPasswordConfirmation();fpcm.ajax.post("passcheck",
{quiet:!0,data:{password:a},execDone:function(a){if(0==a.code)return!1;fpcm.ui.addMessage({type:"error",txt:fpcm.ui.translate("SAVE_FAILED_PASSWORD_SECURITY_PWNDPASS")},!0);return!1}});return!1});fpcm.dom.fromId("genPasswd").click(function(){fpcm.system.generatePasswdString();fpcm.ui.showCurrentPasswordConfirmation();return!1})},showSessionCheckDialog:function(){if(!fpcm.vars.jsvars.sessionCheck)return!0;fpcm.ui_notify.show({body:"SESSION_TIMEOUT",timeout:-1,click:function(a){window.focus()}});fpcm.ui.dialog({content:fpcm.ui.translate("SESSION_TIMEOUT"),
dlButtons:buttons=[{text:fpcm.ui.translate("GLOBAL_YES"),icon:"ui-icon-check",click:function(){fpcm.ui.relocate(fpcm.vars.actionPath+"system/login");fpcm.dom.fromTag(this).dialog("close")}},{text:fpcm.ui.translate("GLOBAL_NO"),icon:"ui-icon-closethick",click:function(){fpcm.vars.jsvars.sessionCheck=!0;fpcm.dom.fromTag(this).dialog("close");fpcm.dom.fromTag(this).remove()}}],id:"sessioncheck"});fpcm.vars.jsvars.sessionCheck=!1},doRefresh:function(){if(fpcm.vars.jsvars.noRefresh)return!1;fpcm.ajax.post("refresh",
{quiet:!0,data:{articleId:fpcm.vars.jsvars.articleId},execDone:function(a){fpcm.worker.postMessage({cmd:"remove",id:"system.refresh"});1==fpcm.vars.jsvars.articleId&&fpcm.editor.showInEditDialog(a);0==a.sessionCode&&fpcm.vars.jsvars.sessionCheck&&fpcm.system.showSessionCheckDialog()}});return!0},generatePasswdString:function(){var a=nkorgPassGen.getPassword(6);fpcm.dom.fromId("password").val(a);fpcm.dom.fromId("password_confirm").val(a);return!1},initMassEditDialog:function(a,b,c,d){void 0===d&&(d=
{});var e="#fpcm-dialog-"+b;fpcm.ui.selectmenu(".fpcm-ui-input-select-massedit",{appendTo:e,removeCornerLeft:!0});"function"===typeof c.initWidgets&&c.initWidgets(e);c=fpcm.ui.getDialogSizes();fpcm.ui.dialog({id:b,dlWidth:c.width,resizable:!0,title:fpcm.ui.translate("GLOBAL_EDIT_SELECTED"),dlButtons:[{text:fpcm.ui.translate("GLOBAL_SAVE"),icon:"ui-icon-check",class:"fpcm-ui-button-primary",click:function(){fpcm.ui.confirmDialog({defaultYes:!0,clickYes:function(){var b=fpcm.ui.getCheckboxCheckedValues(".fpcm-ui-list-checkbox");
if(0==b.length)return fpcm.ui_loader.hide(),!1;b={fields:fpcm.ui.getValuesByClass("fpcm-ui-input-massedit"),ids:fpcm.ajax.toJSON(b)};if(d.multipleSelect)b.fields[d.multipleSelectField]=fpcm.dom.fromId(d.multipleSelect).val();else{var c=fpcm.dom.fromId("categories");c&&(b.fields.categories=c.val())}d.onSuccess&&(b.onSuccess=d.onSuccess);fpcm.system.execMassEdit(a,b);fpcm.dom.fromTag(this).dialog("close")},clickNo:function(){fpcm.dom.fromTag(this).dialog("close")}})}},{text:fpcm.ui.translate("GLOBAL_CLOSE"),
icon:"ui-icon-closethick",click:function(){fpcm.dom.fromTag(this).dialog("close")}}],dlOnClose:function(a,b){a=fpcm.dom.fromId("categories");a[0]&&a[0].selectize.clear();fpcm.ui_loader.hide()}});return!1},execMassEdit:function(a,b){b.onSuccess||(b.onSuccess=function(){fpcm.ui.relocate(window.location.href+(fpcm.vars.jsvars.massEdit&&fpcm.vars.jsvars.massEdit.relocateParams?fpcm.vars.jsvars.massEdit.relocateParams:""))});fpcm.ajax.post(a,{data:b,dataType:"json",execDone:function(a){if(null!==a&&1==
a.code)return b.onSuccess(),!0;fpcm.ui.addMessage({type:"error",id:"fpcm-articles-massedit",icon:"exclamation-triangle",txt:fpcm.vars.jsvars.massEditSaveFailed},!0)}})},clearCache:function(a){a||(a={});fpcm.ajax.post("cache",{data:a,execDone:function(a){fpcm.ui.addMessage(a,!0)}});return!1},emptyTrash:function(a){fpcm.ui.confirmDialog({clickYes:function(){fpcm.ajax.execFunction("clearTrash",a.fn,{pageToken:"ajax/clearTrash",data:{ids:a.ids?a.ids:[]},execDone:function(a){fpcm.ui.resetSelectMenuSelection("#action");
if(!a.msg&&!a.code)return fpcm.ajax.showAjaxErrorMessage(),fpcm.ui_loader.hide(),!1;fpcm.ui.addMessage(a.msg,!0);if(1==a.code)return setTimeout(function(){window.location.reload()},2500),!0}});fpcm.dom.fromTag(this).dialog("close")},clickNoDefault:!0});return!1},showHelpDialog:function(){fpcm.dom.fromClass("fpcm-ui-help-dialog").click(function(){var a=fpcm.dom.fromTag(this);fpcm.ajax.get("help",{data:{ref:a.data("ref"),chapter:a.data("chapter")},execDone:function(a){var b=fpcm.ui.getDialogSizes(top,
.9);fpcm.ui.dialog({id:"help",dlWidth:b.width,dlMaxHeight:b.height,resizable:!1,title:fpcm.ui.translate("HL_HELP"),content:a,dlButtons:[{text:fpcm.ui.translate("GLOBAL_CLOSE"),icon:"ui-icon-closethick",click:function(){fpcm.dom.fromTag(this).dialog("close");return!1}}],dlOnClose:function(a,b){fpcm.dom.fromTag(this).remove()}});fpcm.ui.tabs("#fpcm-ui-tabs-help");a=fpcm.dom.fromId("tabs-help-general").find("h3");if(2>a.length)return fpcm.dom.fromId("fpcm-ui-help-toc-headline").addClass("fpcm-ui-hidden"),
!0;var d=fpcm.dom.fromId("fpcm-ui-help-toc");jQuery.each(a,function(a,b){if(!a)return!0;d.append("<li><strong>"+b.innerText+"</strong></li>")})}});return!1})},checkForUpdates:function(){fpcm.dom.fromId("checkUpdate").click(function(){fpcm.ajax.get("cronasync",{data:{cjId:"updateCheck"}})});return!0},mergeToVars:function(a){a||(a=[]);return jQuery.extend(fpcm,a)},parseUrlQuery:function(a){if(!a)return{};a=a.replace(/.*\?/,"").split("&");for(var b={},c=0;c<a.length;c++)if(void 0!==a[c]){var d=a[c].split(/([a-zA-Z0-9]+)=(.*)/);
b[d[1]]=d[2]}return b}};